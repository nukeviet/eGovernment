/**
 * mOxie - multi-runtime File API & XMLHttpRequest L2 Polyfill
 * v1.5.7
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 *
 * Date: 2017-11-03
 */
/**
 * Plupload - multi-runtime File Uploader
 * v2.3.6
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 *
 * Date: 2017-11-03
 */
/**
 * Fix bug https://github.com/moxiecode/plupload/issues/1510 by NukeViet for use!
 */
var MXI_DEBUG=!1;
(function(J,I){var r=function(){var q={};I.apply(q,arguments);return q.moxie};"function"===typeof define&&define.amd?define("moxie",[],r):"object"===typeof module&&module.exports?module.exports=r():J.moxie=r()})(this||window,function(){(function(J,I){function r(g,k){for(var d,e=[],a=0;a<g.length;++a){if(!(d=L[g[a]]))a:{d=J;for(var b=g[a].split(/[.\/]/),f=0;f<b.length;++f){if(!d[b[f]]){d=void 0;break a}d=d[b[f]]}}if(!d)throw"module definition dependecy not found: "+g[a];e.push(d)}k.apply(null,e)}function q(g,
k,d){if("string"!==typeof g)throw"invalid module definition, module id must be defined and be a string";if(k===I)throw"invalid module definition, dependencies must be specified";if(d===I)throw"invalid module definition, definition function must be specified";r(k,function(){L[g]=d.apply(null,arguments)})}var L={};q("moxie/core/utils/Basic",[],function(){function g(a){return void 0===a?"undefined":null===a?"null":a.nodeType?"node":{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}function k(){return d(!1,
!1,arguments)}function d(b,f,c){var h=c[0];e(c,function(c,m){0<m&&e(c,function(c,l){var e=-1!==a(g(c),["array","object"]);if(void 0===c||b&&void 0===h[l])return!0;if(e&&f)a:{var m=c;switch(g(m)){case "array":c=Array.prototype.slice.call(m);break a;case "object":c=k({},m);break a}c=m}g(h[l])===g(c)&&e?d(b,f,[h[l],c]):h[l]=c})});return h}function e(a,f){var b;if(a){try{var h=a.length}catch(l){h=void 0}if(void 0===h||"number"!==typeof h)for(b in a){if(a.hasOwnProperty(b)&&!1===f(a[b],b))break}else for(b=
0;b<h&&!1!==f(a[b],b);b++);}}function a(a,f){if(f){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(f,a);for(var b=0,h=f.length;b<h;b++)if(f[b]===a)return b}return-1}return{guid:function(){var a=0;return function(b){var f=(new Date).getTime().toString(32),h;for(h=0;5>h;h++)f+=Math.floor(65535*Math.random()).toString(32);return(b||"o_")+f+(a++).toString(32)}}(),typeOf:g,extend:k,extendIf:function(){return d(!0,!1,arguments)},extendImmutable:function(){return d(!1,!0,arguments)},extendImmutableIf:function(){return d(!0,
!0,arguments)},clone:function(a){switch(g(a)){case "array":return d(!1,!0,[[],a]);case "object":return d(!1,!0,[{},a]);default:return a}},inherit:function(a,f){function b(){this.constructor=a;if(MXI_DEBUG){var b=a.toString().match(/^function\s([^\(\s]+)/);this.ctorName=b?b[1]:!1}}for(var h in f)({}).hasOwnProperty.call(f,h)&&(a[h]=f[h]);b.prototype=f.prototype;a.prototype=new b;a.parent=f.prototype;return a},each:e,isEmptyObj:function(a){var b;if(!a||"object"!==g(a))return!0;for(b in a)return!1;return!0},
inSeries:function(a,f){function b(c){if("function"===g(a[c]))a[c](function(a){++c<h&&!a?b(c):f(a)})}var h=a.length;"function"!==g(f)&&(f=function(){});a&&a.length||f();b(0)},inParallel:function(a,f){var b=0,h=a.length,d=Array(h);e(a,function(a,c){a(function(a){if(a)return f(a);var e=[].slice.call(arguments);e.shift();d[c]=e;b++;b===h&&(d.unshift(null),f.apply(this,d))})})},inArray:a,arrayDiff:function(b,f){var c=[];"array"!==g(b)&&(b=[b]);"array"!==g(f)&&(f=[f]);for(var h in b)-1===a(b[h],f)&&c.push(b[h]);
return c.length?c:!1},arrayIntersect:function(b,f){var c=[];e(b,function(b){-1!==a(b,f)&&c.push(b)});return c.length?c:null},toArray:function(a){var b,c=[];for(b=0;b<a.length;b++)c[b]=a[b];return c},trim:function(a){return a?String.prototype.trim?String.prototype.trim.call(a):a.toString().replace(/^\s*/,"").replace(/\s*$/,""):a},sprintf:function(a){var b=[].slice.call(arguments,1);return a.replace(/%([a-z])/g,function(a,f){var c=b.shift();switch(f){case "s":return c+"";case "d":return parseInt(c,
10);case "f":return parseFloat(c);case "c":return"";default:return c}})},parseSizeStr:function(a){if("string"!==typeof a)return a;var b={t:1099511627776,g:1073741824,m:1048576,k:1024};a=/^([0-9\.]+)([tmgk]?)$/.exec(a.toLowerCase().replace(/[^0-9\.tmkg]/g,""));var c=a[2];a=+a[1];b.hasOwnProperty(c)&&(a*=b[c]);return Math.floor(a)},delay:function(a,f){var b=this;setTimeout(function(){a.call(b)},f||1)}}});q("moxie/core/utils/Encode",[],function(){var g=function(d){return unescape(encodeURIComponent(d))},
k=function(d){return decodeURIComponent(escape(d))};return{utf8_encode:g,utf8_decode:k,atob:function(d,e){if("function"===typeof window.atob)return e?k(window.atob(d)):window.atob(d);var a=0,b=0,f=[];if(!d)return d;d+="";do{var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d.charAt(a++));var h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d.charAt(a++));var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d.charAt(a++));
var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d.charAt(a++));var n=c<<18|h<<12|l<<6|m;c=n>>16&255;h=n>>8&255;n&=255;64==l?f[b++]=String.fromCharCode(c):64==m?f[b++]=String.fromCharCode(c,h):f[b++]=String.fromCharCode(c,h,n)}while(a<d.length);l=f.join("");return e?k(l):l},btoa:function(d,e){e&&(d=g(d));if("function"===typeof window.btoa)return window.btoa(d);var a=0,b=0,f=[];if(!d)return d;do{var c=d.charCodeAt(a++);var h=d.charCodeAt(a++);var l=d.charCodeAt(a++);
var m=c<<16|h<<8|l;c=m>>18&63;h=m>>12&63;l=m>>6&63;m&=63;f[b++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)}while(a<d.length);a=f.join("");b=d.length%3;return(b?a.slice(0,b-3):a)+"===".slice(b||3)}}});q("moxie/core/utils/Env",["moxie/core/utils/Basic"],
function(g){var k=function(a){var b={has:function(a,b){return-1!==b.toLowerCase().indexOf(a.toLowerCase())},lowerize:function(a){return a.toLowerCase()}},c=function(){for(var b,f=0,c,h,d,e,l,m=arguments;f<m.length;f+=2){l=m[f];var n=m[f+1];if("undefined"===typeof b)for(d in b={},n)c=n[d],"object"===typeof c?b[c[0]]=a:b[c]=a;for(c=h=0;c<l.length;c++)if(e=l[c].exec(this.getUA())){for(d=0;d<n.length;d++)l=e[++h],c=n[d],"object"===typeof c&&0<c.length?2==c.length?b[c[0]]="function"==typeof c[1]?c[1].call(this,
l):c[1]:3==c.length?b[c[0]]="function"!==typeof c[1]||c[1].exec&&c[1].test?l?l.replace(c[1],c[2]):a:l?c[1].call(this,l,c[2]):a:4==c.length&&(b[c[0]]=l?c[3].call(this,l.replace(c[1],c[2])):a):b[c]=l?l:a;break}if(e)break}return b},h=function(c,f){for(var h in f)if("object"===typeof f[h]&&0<f[h].length)for(var d=0;d<f[h].length;d++){if(b.has(f[h][d],c))return"?"===h?a:h}else if(b.has(f[h],c))return"?"===h?a:h;return c},d={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2E3:"NT 5.0",XP:["NT 5.1","NT 5.2"],
Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",RT:"ARM"},e=[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],["name","version"],[/\s(opr)\/([\w\.]+)/i],[["name","Opera"],"version"],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],
["name","version"],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[["name","IE"],"version"],[/(edge)\/((\d+)?[\w\.]+)/i],["name","version"],[/(yabrowser)\/([\w\.]+)/i],[["name","Yandex"],"version"],[/(comodo_dragon)\/([\w\.]+)/i],[["name",/_/g," "],"version"],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],["name","version"],[/(dolfin)\/([\w\.]+)/i],[["name","Dolphin"],"version"],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[["name","Chrome"],
"version"],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],["version",["name","MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],["version",["name","Android Browser"]],[/FBAV\/([\w\.]+);/i],["version",["name","Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],["version",["name","Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],["version","name"],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],["name",["version",h,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412",
"2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],["name","version"],[/(navigator|netscape)\/([\w\.-]+)/i],[["name","Netscape"],"version"],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,
/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],["name","version"]],n=[[/windows.+\sedge\/([\w\.]+)/i],["version",["name","EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],["name","version"],[/rv:([\w\.]+).*(gecko)/i],["version","name"]],g=[[/microsoft\s(windows)\s(vista|xp)/i],["name","version"],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],
["name",["version",h,d]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[["name","Windows"],["version",h,d]],[/\((bb)(10);/i],[["name","BlackBerry"],"version"],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palmos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],["name","version"],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[["name","Symbian"],"version"],[/\((series40);/i],["name"],[/mozilla.+\(mobile;.+gecko.+firefox/i],[["name",
"Firefox OS"],"version"],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],["name","version"],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[["name","Chromium OS"],"version"],[/(sunos)\s?([\w\.]+\d)*/i],[["name","Solaris"],"version"],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],
["name","version"],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[["name","iOS"],["version",/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[["name","Mac OS"],["version",/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],["name","version"]];return function(a){var b=a||(window&&window.navigator&&window.navigator.userAgent?
window.navigator.userAgent:"");this.getBrowser=function(){return c.apply(this,e)};this.getEngine=function(){return c.apply(this,n)};this.getOS=function(){return c.apply(this,g)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}};this.getUA=function(){return b};this.setUA=function(a){b=a;return this};this.setUA(b)}}(),d=function(){var b={access_global_ns:function(){return!!window.moxie},define_property:!1,create_canvas:function(){var a=
document.createElement("canvas");a=!(!a.getContext||!a.getContext("2d"));return b.create_canvas=a},return_response_type:function(a){try{if(-1!==g.inArray(a,["","text","document"]))return!0;if(window.XMLHttpRequest){var b=new XMLHttpRequest;b.open("get","/");if("responseType"in b)return b.responseType=a,b.responseType!==a?!1:!0}}catch(h){}return!1},use_blob_uri:function(){var f=window.URL;b.use_blob_uri=f&&"createObjectURL"in f&&"revokeObjectURL"in f&&("IE"!==a.browser||a.verComp(a.version,"11.0.46",
">="));return b.use_blob_uri},use_data_uri:function(){var a=new Image;a.onload=function(){b.use_data_uri=1===a.width&&1===a.height};setTimeout(function(){a.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1);return!1}(),use_data_uri_over32kb:function(){return b.use_data_uri&&("IE"!==a.browser||9<=a.version)},use_data_uri_of:function(a){return b.use_data_uri&&33E3>a||b.use_data_uri_over32kb()},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return!1;
var a=document.createElement("input");a.setAttribute("type","file");return b.use_fileinput=!a.disabled},use_webgl:function(){var a=document.createElement("canvas"),c=null;try{c=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(h){}c||(c=null);a=!!c;return b.use_webgl=a}};return function(a){var c=[].slice.call(arguments);c.shift();return"function"===g.typeOf(b[a])?b[a].apply(this,c):!!b[a]}}(),e=(new k).getResult(),a={can:d,uaParser:k,browser:e.browser.name,version:e.browser.version,
os:e.os.name,osVersion:e.os.version,verComp:function(a,f,c){var b=0,d=0,e=0,n={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1};b=function(a){a=(""+a).replace(/[_\-+]/g,".");a=a.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,".");return a.length?a.split("."):[-8]};var g=function(a){return a?isNaN(a)?n[a]||-7:parseInt(a,10):0};a=b(a);f=b(f);d=Math.max(a.length,f.length);for(b=0;b<d;b++)if(a[b]!=f[b])if(a[b]=g(a[b]),f[b]=g(f[b]),a[b]<f[b]){e=-1;break}else if(a[b]>f[b]){e=1;break}if(!c)return e;
switch(c){case ">":case "gt":return 0<e;case ">=":case "ge":return 0<=e;case "<=":case "le":return 0>=e;case "==":case "=":case "eq":return 0===e;case "<>":case "!=":case "ne":return 0!==e;case "":case "<":case "lt":return 0>e;default:return null}},swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};a.OS=a.os;MXI_DEBUG&&(a.debug={runtime:!0,events:!1},a.log=function(){if(window&&window.console&&window.console.log&&
window.console.log.apply)window.console.log.apply(window.console,arguments);else if(document){var a=document.getElementById("moxie-console");a||(a=document.createElement("pre"),a.id="moxie-console",document.body.appendChild(a));var f=arguments[0];if("string"===g.typeOf(f))f=g.sprintf.apply(this,arguments);else if(-1!==g.inArray(g.typeOf(f),["object","array"])){a.appendChild(document.createTextNode(f+"\n"));return}a.appendChild(document.createTextNode(f+"\n"))}});return a});q("moxie/core/Exceptions",
["moxie/core/utils/Basic"],function(g){function k(d,e){for(var a in d)if(d[a]===e)return a;return null}return{RuntimeError:function(){function d(a,b){this.code=a;this.name=k(e,a);this.message=this.name+(b||": RuntimeError "+this.code)}var e={NOT_INIT_ERR:1,EXCEPTION_ERR:3,NOT_SUPPORTED_ERR:9,JS_ERR:4};g.extend(d,e);d.prototype=Error.prototype;return d}(),OperationNotAllowedException:function(){function d(d){this.code=d;this.name="OperationNotAllowedException"}g.extend(d,{NOT_ALLOWED_ERR:1});d.prototype=
Error.prototype;return d}(),ImageError:function(){function d(a){this.code=a;this.name=k(e,a);this.message=this.name+": ImageError "+this.code}var e={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};g.extend(d,e);d.prototype=Error.prototype;return d}(),FileException:function(){function d(a){this.code=a;this.name=k(e,a);this.message=this.name+": FileException "+this.code}var e={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,
SYNTAX_ERR:8};g.extend(d,e);d.prototype=Error.prototype;return d}(),DOMException:function(){function d(a){this.code=a;this.name=k(e,a);this.message=this.name+": DOMException "+this.code}var e={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,
VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};g.extend(d,e);d.prototype=Error.prototype;return d}(),EventException:function(){function d(d){this.code=d;this.name="EventException"}g.extend(d,{UNSPECIFIED_EVENT_TYPE_ERR:0});d.prototype=Error.prototype;return d}()}});q("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(g){var k=function(d,e){return d.className?
(new RegExp("(^|\\s+)"+e+"(\\s+|$)")).test(d.className):!1};return{get:function(d){return"string"!==typeof d?d:document.getElementById(d)},hasClass:k,addClass:function(d,e){k(d,e)||(d.className=d.className?d.className.replace(/\s+$/,"")+" "+e:e)},removeClass:function(d,e){d.className&&(d.className=d.className.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)"),function(a,b,f){return" "===b&&" "===f?" ":""}))},getStyle:function(d,e){if(d.currentStyle)return d.currentStyle[e];if(window.getComputedStyle)return window.getComputedStyle(d,
null)[e]},getPos:function(d,e){function a(a){var b=0;var c=0;a&&(c=a.getBoundingClientRect(),a="CSS1Compat"===h.compatMode?h.documentElement:h.body,b=c.left+a.scrollLeft,c=c.top+a.scrollTop);return{x:b,y:c}}var b=0,f=0,c,h=document;e=e||h.body;if(d&&d.getBoundingClientRect&&"IE"===g.browser&&(!h.documentMode||8>h.documentMode))return b=a(d),f=a(e),{x:b.x-f.x,y:b.y-f.y};for(c=d;c&&c!=e&&c.nodeType;)b+=c.offsetLeft||0,f+=c.offsetTop||0,c=c.offsetParent;for(c=d.parentNode;c&&c!=e&&c.nodeType;)b-=c.scrollLeft||
0,f-=c.scrollTop||0,c=c.parentNode;return{x:b,y:f}},getSize:function(d){return{w:d.offsetWidth||d.clientWidth,h:d.offsetHeight||d.clientHeight}}}});q("moxie/core/EventTarget",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic"],function(g,k,d){function e(){this.uid=d.guid()}var a={};d.extend(e.prototype,{init:function(){this.uid||(this.uid=d.guid("uid_"))},addEventListener:function(b,f,c,h){var e=this;this.hasOwnProperty("uid")||(this.uid=d.guid("uid_"));b=d.trim(b);if(/\s/.test(b))d.each(b.split(/\s+/),
function(a){e.addEventListener(a,f,c,h)});else{b=b.toLowerCase();c=parseInt(c,10)||0;var m=a[this.uid]&&a[this.uid][b]||[];m.push({fn:f,priority:c,scope:h||this});a[this.uid]||(a[this.uid]={});a[this.uid][b]=m}},hasEventListener:function(b){b?(b=b.toLowerCase(),b=a[this.uid]&&a[this.uid][b]):b=a[this.uid];return b?b:!1},removeEventListener:function(b,f){var c=this,h,e;b=b.toLowerCase();if(/\s/.test(b))d.each(b.split(/\s+/),function(a){c.removeEventListener(a,f)});else if(h=a[this.uid]&&a[this.uid][b]){if(f)for(e=
h.length-1;0<=e;e--){if(h[e].fn===f){h.splice(e,1);break}}else h=[];h.length||(delete a[this.uid][b],d.isEmptyObj(a[this.uid])&&delete a[this.uid])}},removeAllEventListeners:function(){a[this.uid]&&delete a[this.uid]},dispatchEvent:function(b){var f,c={},h=!0;if("string"!==d.typeOf(b)){var e=b;if("string"===d.typeOf(e.type))b=e.type,void 0!==e.total&&void 0!==e.loaded&&(c.total=e.total,c.loaded=e.loaded),c.async=e.async||!1;else throw new k.EventException(k.EventException.UNSPECIFIED_EVENT_TYPE_ERR);
}-1!==b.indexOf("::")?function(a){f=a[0];b=a[1]}(b.split("::")):f=this.uid;b=b.toLowerCase();if(e=a[f]&&a[f][b]){e.sort(function(a,b){return b.priority-a.priority});var m=[].slice.call(arguments);m.shift();c.type=b;m.unshift(c);MXI_DEBUG&&g.debug.events&&g.log("%cEvent '%s' fired on %s","color: #999;",c.type,(this.ctorName?this.ctorName+"::":"")+f);var n=[];d.each(e,function(a){m[0].target=a.scope;c.async?n.push(function(b){setTimeout(function(){b(!1===a.fn.apply(a.scope,m))},1)}):n.push(function(b){b(!1===
a.fn.apply(a.scope,m))})});n.length&&d.inSeries(n,function(a){h=!a})}return h},bindOnce:function(a,f,c,d){var b=this;b.bind.call(this,a,function n(){b.unbind(a,n);return f.apply(this,arguments)},c,d)},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(a){var b=
this;this.bind(a.join(" "),function(a){var b="on"+a.type.toLowerCase();"function"===d.typeOf(this[b])&&this[b].apply(this,arguments)});d.each(a,function(a){a="on"+a.toLowerCase(a);"undefined"===d.typeOf(b[a])&&(b[a]=null)})}});e.instance=new e;return e});q("moxie/runtime/Runtime",["moxie/core/utils/Env","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(g,k,d,e){function a(b,e,l,m,n){var c=this,h=k.guid(e+"_");n=n||"browser";b=b||{};f[h]=this;l=k.extend({access_binary:!1,
access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},l);b.preferred_caps&&(n=a.getMode(m,b.preferred_caps,n));MXI_DEBUG&&
g.debug.runtime&&g.log("\tdefault mode: %s",n);var A=function(){var a={};return{exec:function(b,c,f,d){if(A[c]&&(a[b]||(a[b]={context:this,instance:new A[c]}),a[b].instance[f]))return a[b].instance[f].apply(this,d)},removeInstance:function(b){delete a[b]},removeAllInstances:function(){var b=this;k.each(a,function(a,c){"function"===k.typeOf(a.instance.destroy)&&a.instance.destroy.call(a.context);b.removeInstance(c)})}}}();k.extend(this,{initialized:!1,uid:h,type:e,mode:a.getMode(m,b.required_caps,
n),shimid:h+"_container",clients:0,options:b,can:function(b,c,f){f=f||l;"string"===k.typeOf(b)&&"undefined"===k.typeOf(c)&&(b=a.parseCaps(b));if("object"===k.typeOf(b)){for(var d in b)if(!this.can(d,b[d],f))return!1;return!0}return"function"===k.typeOf(f[b])?f[b].call(this,c):c===f[b]},getShimContainer:function(){var a=d.get(this.shimid);if(!a){var b=d.get(this.options.container)||document.body;a=document.createElement("div");a.id=this.shimid;a.className="moxie-shim moxie-shim-"+this.type;k.extend(a.style,
{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});b.appendChild(a)}return a},getShim:function(){return A},shimExec:function(a,b){var f=[].slice.call(arguments,2);return c.getShim().exec.call(this,this.uid,a,b,f)},exec:function(a,b){var f=[].slice.call(arguments,2);return c[a]&&c[a][b]?c[a][b].apply(this,f):c.shimExec.apply(this,arguments)},destroy:function(){if(c){var a=d.get(this.shimid);a&&a.parentNode.removeChild(a);A&&A.removeAllInstances();this.unbindAll();
delete f[this.uid];h=c=A=this.uid=null}}});this.mode&&b.required_caps&&!this.can(b.required_caps)&&(this.mode=!1)}var b={},f={};a.order="html5,flash,silverlight,html4";a.getRuntime=function(a){return f[a]?f[a]:!1};a.addConstructor=function(a,f){f.prototype=e.instance;b[a]=f};a.getConstructor=function(a){return b[a]||null};a.getInfo=function(b){var c=a.getRuntime(b);return c?{uid:c.uid,type:c.type,mode:c.mode,can:function(){return c.can.apply(c,arguments)}}:null};a.parseCaps=function(a){var b={};if("string"!==
k.typeOf(a))return a||{};k.each(a.split(","),function(a){b[a]=!0});return b};a.can=function(b,f){var c=a.getConstructor(b);if(c){c=new c({required_caps:f});var d=c.mode;c.destroy();return!!d}return!1};a.thatCan=function(b,f){var c=(f||a.order).split(/\s*,\s*/),d;for(d in c)if(a.can(c[d],b))return c[d];return null};a.getMode=function(a,b,f){var c=null;"undefined"===k.typeOf(f)&&(f="browser");if(b&&!k.isEmptyObj(a)){k.each(b,function(b,f){if(a.hasOwnProperty(f)){var d=a[f](b);"string"===typeof d&&(d=
[d]);if(!c)c=d;else if(!(c=k.arrayIntersect(c,d)))return MXI_DEBUG&&g.debug.runtime&&g.log("\t\t%s: %s (conflicting mode requested: %s)",f,b,d),c=!1}MXI_DEBUG&&g.debug.runtime&&g.log("\t\t%s: %s (compatible modes: %s)",f,b,c)});if(c)return-1!==k.inArray(f,c)?f:c[0];if(!1===c)return!1}return f};a.getGlobalEventTarget=function(){if(/^moxie\./.test(g.global_event_dispatcher)&&!g.can("access_global_ns")){var a=k.guid("moxie_event_target_");window[a]=function(a,b){e.instance.dispatchEvent(a,b)};g.global_event_dispatcher=
a}return g.global_event_dispatcher};a.capTrue=function(){return!0};a.capFalse=function(){return!1};a.capTest=function(a){return function(){return!!a}};return a});q("moxie/runtime/RuntimeClient",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(g,k,d,e){return function(){var a;d.extend(this,{connectRuntime:function(b){function f(d){var h;if(d.length){var l=d.shift().toLowerCase();(h=e.getConstructor(l))?(MXI_DEBUG&&g.debug.runtime&&(g.log("Trying runtime: %s",
l),g.log(b)),a=new h(b),a.bind("Init",function(){a.initialized=!0;MXI_DEBUG&&g.debug.runtime&&g.log("Runtime '%s' initialized",a.type);setTimeout(function(){a.clients++;c.ruid=a.uid;c.trigger("RuntimeInit",a)},1)}),a.bind("Error",function(){MXI_DEBUG&&g.debug.runtime&&g.log("Runtime '%s' failed to initialize",a.type);a.destroy();f(d)}),a.bind("Exception",function(a,b){var f=b.name+"(#"+b.code+")"+(b.message?", from: "+b.message:"");MXI_DEBUG&&g.debug.runtime&&g.log("Runtime '%s' has thrown an exception: %s",
this.type,f);c.trigger("RuntimeError",new k.RuntimeError(k.RuntimeError.EXCEPTION_ERR,f))}),MXI_DEBUG&&g.debug.runtime&&g.log("\tselected mode: %s",a.mode),a.mode?a.init():a.trigger("Error")):(MXI_DEBUG&&g.debug.runtime&&g.log("Constructor for '%s' runtime is not available.",l),f(d))}else c.trigger("RuntimeError",new k.RuntimeError(k.RuntimeError.NOT_INIT_ERR)),a=null}var c=this;if("string"===d.typeOf(b))var h=b;else"string"===d.typeOf(b.ruid)&&(h=b.ruid);if(h){if(a=e.getRuntime(h))return c.ruid=
h,a.clients++,a;throw new k.RuntimeError(k.RuntimeError.NOT_INIT_ERR);}f((b.runtime_order||e.order).split(/\s*,\s*/))},disconnectRuntime:function(){a&&0>=--a.clients&&a.destroy();a=null},getRuntime:function(){return a&&a.uid?a:a=null},exec:function(){return a?a.exec.apply(this,arguments):null},can:function(b){return a?a.can(b):!1}})}});q("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(g,k,d){function e(b,f){function c(b,c,f){var d=a[this.uid];
if("string"!==g.typeOf(d)||!d.length)return null;c=new e(null,{type:f,size:c-b});c.detach(d.substr(b,c.size));return c}d.call(this);b&&this.connectRuntime(b);f?"string"===g.typeOf(f)&&(f={data:f}):f={};g.extend(this,{uid:f.uid||g.guid("uid_"),ruid:b,size:f.size||0,type:f.type||"",slice:function(a,b,f){return this.isDetached()?c.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),a,b,f)},getSource:function(){return a[this.uid]?a[this.uid]:null},detach:function(b){this.ruid&&
(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null);b=b||"";if("data:"==b.substr(0,5)){var c=b.indexOf(";base64,");this.type=b.substring(5,c);b=k.atob(b.substring(c+8))}this.size=b.length;a[this.uid]=b},isDetached:function(){return!this.ruid&&"string"===g.typeOf(a[this.uid])},destroy:function(){this.detach();delete a[this.uid]}});f.data?this.detach(f.data):a[this.uid]=f}var a={};return e});q("moxie/core/I18n",["moxie/core/utils/Basic"],function(g){var k={};
return{addI18n:function(d){return g.extend(k,d)},translate:function(d){return k[d]||d},_:function(d){return this.translate(d)},sprintf:function(d){var e=[].slice.call(arguments,1);return d.replace(/%[a-z]/g,function(){var a=e.shift();return"undefined"!==g.typeOf(a)?a:""})}}});q("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(g,k){var d={},e={},a=function(a){a=a.split(/,/);var b,c;for(b=0;b<a.length;b+=2){var f=a[b+1].split(/ /);for(c=0;c<f.length;c++)d[f[c]]=a[b];e[a[b]]=
f}},b=function(a){var b=[];g.each(a,function(a){a=a.toLowerCase();if("*"===a)return b=[],!1;var c=a.match(/^(\w+)\/(\*|\w+)$/);c&&("*"===c[2]?g.each(e,function(a,f){(new RegExp("^"+c[1]+"/")).test(f)&&[].push.apply(b,e[f])}):e[a]&&[].push.apply(b,e[a]))});return b},f=function(a){return(a=a&&a.match(/\.([^.]+)$/))?a[1].toLowerCase():""};a("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb xlt xla,application/vnd.ms-powerpoint,ppt pps pot ppa,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");
return{mimes:d,extensions:e,addMimeType:a,extList2mimes:function(a,b){var c,f,d=[];for(c=0;c<a.length;c++){var e=a[c].extensions.toLowerCase().split(/\s*,\s*/);for(f=0;f<e.length;f++){if("*"===e[f])return[];var h=d[e[f]];if(b&&/^\w+$/.test(e[f]))d.push("."+e[f]);else if(h&&-1===g.inArray(h,d))d.push(h);else if(!h)return[]}}return d},mimes2exts:b,mimes2extList:function(a){var f=[];"string"===g.typeOf(a)&&(a=g.trim(a).split(/\s*,\s*/));a=b(a);f.push({title:k.translate("Files"),extensions:a.length?a.join(","):
"*"});return f},getFileExtension:f,getFileMime:function(a){return d[f(a)]||""}}});q("moxie/file/FileInput","moxie/core/utils/Basic moxie/core/utils/Env moxie/core/utils/Mime moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/core/I18n moxie/runtime/Runtime moxie/runtime/RuntimeClient".split(" "),function(g,k,d,e,a,b,f,c,h){function l(b){MXI_DEBUG&&k.log("Instantiating FileInput...");-1!==g.inArray(g.typeOf(b),["string","node"])&&(b={browse_button:b});var l=e.get(b.browse_button);
if(!l)throw new a.DOMException(a.DOMException.NOT_FOUND_ERR);l={accept:[{title:f.translate("All Files"),extensions:"*"}],multiple:!1,required_caps:!1,container:l.parentNode||document.body};b=g.extend({},l,b);"string"===typeof b.required_caps&&(b.required_caps=c.parseCaps(b.required_caps));"string"===typeof b.accept&&(b.accept=d.mimes2extList(b.accept));l=e.get(b.container);l||(l=document.body);"static"===e.getStyle(l,"position")&&(l.style.position="relative");l=l=null;h.call(this);g.extend(this,{uid:g.guid("uid_"),
ruid:null,shimid:null,files:null,init:function(){var a=this;a.bind("RuntimeInit",function(f,c){a.ruid=c.uid;a.shimid=c.shimid;a.bind("Ready",function(){a.trigger("Refresh")},999);a.bind("Refresh",function(){var a=e.get(b.browse_button);var f=e.get(c.shimid);if(a){var d=e.getPos(a,e.get(b.container));var h=e.getSize(a);a=parseInt(e.getStyle(a,"z-index"),10)||0;f&&g.extend(f.style,{top:d.y+"px",left:d.x+"px",width:h.w+"px",height:h.h+"px",zIndex:a+1})}});c.exec.call(a,"FileInput","init",b)});a.connectRuntime(g.extend({},
b,{required_caps:{select_file:!0}}))},getOption:function(a){return b[a]},setOption:function(f,c){if(b.hasOwnProperty(f)){var e=b[f];switch(f){case "accept":"string"===typeof c&&(c=d.mimes2extList(c));break;case "container":case "required_caps":throw new a.FileException(a.FileException.NO_MODIFICATION_ALLOWED_ERR);}b[f]=c;this.exec("FileInput","setOption",f,c);this.trigger("OptionChanged",f,c,e)}},disable:function(a){this.getRuntime()&&this.exec("FileInput","disable","undefined"===g.typeOf(a)?!0:a)},
refresh:function(){this.trigger("Refresh")},destroy:function(){var a=this.getRuntime();a&&(a.exec.call(this,"FileInput","destroy"),this.disconnectRuntime());"array"===g.typeOf(this.files)&&g.each(this.files,function(a){a.destroy()});this.files=null;this.unbindAll()}});this.handleEventProps(m)}var m="ready change cancel mouseenter mouseleave mousedown mouseup".split(" ");l.prototype=b.instance;return l});q("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(g,
k,d){function e(a,b){b||(b={});d.apply(this,arguments);this.type||(this.type=k.getFileMime(b.name));if(b.name){var f=b.name.replace(/\\/g,"/");f=f.substr(f.lastIndexOf("/")+1)}else this.type&&(f=this.type.split("/")[0],f=g.guid((""!==f?f:"file")+"_"),k.extensions[this.type]&&(f+="."+k.extensions[this.type][0]));g.extend(this,{name:f||g.guid("file_"),relativePath:"",lastModifiedDate:b.lastModifiedDate||(new Date).toLocaleString()})}e.prototype=d.prototype;return e});q("moxie/file/FileDrop","moxie/core/I18n moxie/core/utils/Dom moxie/core/Exceptions moxie/core/utils/Basic moxie/core/utils/Env moxie/file/File moxie/runtime/RuntimeClient moxie/core/EventTarget moxie/core/utils/Mime".split(" "),
function(g,k,d,e,a,b,f,c,h){function l(b){MXI_DEBUG&&a.log("Instantiating FileDrop...");var c=this;"string"===typeof b&&(b={drop_zone:b});var d={accept:[{title:g.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}};b="object"===typeof b?e.extend({},d,b):d;b.container=k.get(b.drop_zone)||document.body;"static"===k.getStyle(b.container,"position")&&(b.container.style.position="relative");"string"===typeof b.accept&&(b.accept=h.mimes2extList(b.accept));f.call(c);e.extend(c,{uid:e.guid("uid_"),
ruid:null,files:null,init:function(){c.bind("RuntimeInit",function(a,f){c.ruid=f.uid;f.exec.call(c,"FileDrop","init",b);c.dispatchEvent("ready")});c.connectRuntime(b)},destroy:function(){var a=this.getRuntime();a&&(a.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime());this.files=null;this.unbindAll()}});this.handleEventProps(m)}var m=["ready","dragenter","dragleave","drop","error"];l.prototype=c.instance;return l});q("moxie/file/FileReader","moxie/core/utils/Basic moxie/core/utils/Encode moxie/core/Exceptions moxie/core/EventTarget moxie/file/Blob moxie/runtime/RuntimeClient".split(" "),
function(g,k,d,e,a,b){function f(){function e(b,c){this.trigger("loadstart");if(this.readyState===f.LOADING)this.trigger("error",new d.DOMException(d.DOMException.INVALID_STATE_ERR)),this.trigger("loadend");else if(c instanceof a)if(this.result=null,this.readyState=f.LOADING,c.isDetached()){var e=c.getSource();switch(b){case "readAsText":case "readAsBinaryString":this.result=e;break;case "readAsDataURL":this.result="data:"+c.type+";base64,"+k.btoa(e)}this.readyState=f.DONE;this.trigger("load");this.trigger("loadend")}else this.connectRuntime(c.ruid),
this.exec("FileReader","read",b,c);else this.trigger("error",new d.DOMException(d.DOMException.NOT_FOUND_ERR)),this.trigger("loadend")}b.call(this);g.extend(this,{uid:g.guid("uid_"),readyState:f.EMPTY,result:null,error:null,readAsBinaryString:function(a){e.call(this,"readAsBinaryString",a)},readAsDataURL:function(a){e.call(this,"readAsDataURL",a)},readAsText:function(a){e.call(this,"readAsText",a)},abort:function(){this.result=null;-1===g.inArray(this.readyState,[f.EMPTY,f.DONE])&&(this.readyState===
f.LOADING&&(this.readyState=f.DONE),this.exec("FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort();this.exec("FileReader","destroy");this.disconnectRuntime();this.unbindAll()}});this.handleEventProps(c);this.bind("Error",function(a,b){this.readyState=f.DONE;this.error=b},999);this.bind("Load",function(a){this.readyState=f.DONE},999)}var c="loadstart progress load abort error loadend".split(" ");f.EMPTY=0;f.LOADING=1;f.DONE=2;f.prototype=e.instance;
return f});q("moxie/core/utils/Url",["moxie/core/utils/Basic"],function(g){var k=function(d,e){var a="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" "),b=a.length,f={http:80,https:443},c={},h=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?(\[[\da-fA-F:]+\]|[^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(d||""),l=/^\/\/\w/.test(d);switch(g.typeOf(e)){case "undefined":e=k(document.location.href,
!1);break;case "string":e=k(e,!1)}for(;b--;)h[b]&&(c[a[b]]=h[b]);a=!l&&!c.scheme;if(l||a)c.scheme=e.scheme;a&&(c.host=e.host,c.port=e.port,l="",/^[^\/]/.test(c.path)&&(l=e.path,l=/\/[^\/]*\.[^\/]*$/.test(l)?l.replace(/\/[^\/]+$/,"/"):l.replace(/\/?$/,"/")),c.path=l+(c.path||""));c.port||(c.port=f[c.scheme]||80);c.port=parseInt(c.port,10);c.path||(c.path="/");delete c.source;return c};return{parseUrl:k,resolveUrl:function(d){d="object"===typeof d?d:k(d);return d.scheme+"://"+d.host+(d.port!=={http:80,
https:443}[d.scheme]?":"+d.port:"")+d.path+(d.query?d.query:"")},hasSameOrigin:function(d){function e(a){return[a.scheme,a.host,a.port].join("/")}"string"===typeof d&&(d=k(d));return e(k())===e(d)}}});q("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(g,k,d){function e(){this.uid=g.guid("uid_");k.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}e.prototype=d.instance;return e});q("moxie/file/FileReaderSync",
["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(g,k,d){return function(){function e(a,b){if(b.isDetached()){var f=b.getSource();switch(a){case "readAsBinaryString":return f;case "readAsDataURL":return"data:"+b.type+";base64,"+d.btoa(f);case "readAsText":for(var c="",e=0,l=f.length;e<l;e++)c+=String.fromCharCode(f[e]);return c}}else return f=this.connectRuntime(b.ruid).exec.call(this,"FileReaderSync","read",a,b),this.disconnectRuntime(),f}k.call(this);g.extend(this,
{uid:g.guid("uid_"),readAsBinaryString:function(a){return e.call(this,"readAsBinaryString",a)},readAsDataURL:function(a){return e.call(this,"readAsDataURL",a)},readAsText:function(a){return e.call(this,"readAsText",a)}})}});q("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(g,k,d){return function(){var e,a=[];k.extend(this,{append:function(b,f){var c=this,h=k.typeOf(f);f instanceof d?e={name:b,value:f}:"array"===h?(b+="[]",k.each(f,function(a){c.append(b,
a)})):"object"===h?k.each(f,function(a,f){c.append(b+"["+f+"]",a)}):"null"===h||"undefined"===h||"number"===h&&isNaN(f)?c.append(b,"false"):a.push({name:b,value:f.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return e&&e.value||null},getBlobName:function(){return e&&e.name||null},each:function(b){k.each(a,function(a){b(a.value,a.name)});e&&b(e.value,e.name)},destroy:function(){e=null;a=[]}})}});q("moxie/xhr/XMLHttpRequest","moxie/core/utils/Basic moxie/core/Exceptions moxie/core/EventTarget moxie/core/utils/Encode moxie/core/utils/Url moxie/runtime/Runtime moxie/runtime/RuntimeTarget moxie/file/Blob moxie/file/FileReaderSync moxie/xhr/FormData moxie/core/utils/Env moxie/core/utils/Mime".split(" "),
function(g,k,d,e,a,b,f,c,h,l,m,n){function v(){this.uid=g.guid("uid_")}function p(){function d(a,b){if(u.hasOwnProperty(a)){if(1===arguments.length)return m.can("define_property")?u[a]:t[a];m.can("define_property")?u[a]=b:t[a]=b}}function h(a){function c(){D&&(D.destroy(),D=null);h.dispatchEvent("loadend");h=null}function e(b){D.bind("LoadStart",function(a){d("readyState",p.LOADING);h.dispatchEvent("readystatechange");h.dispatchEvent(a);x&&h.upload.dispatchEvent(a)});D.bind("Progress",function(a){d("readyState")!==
p.LOADING&&(d("readyState",p.LOADING),h.dispatchEvent("readystatechange"));h.dispatchEvent(a)});D.bind("UploadProgress",function(a){x&&h.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:a.total,loaded:a.loaded})});D.bind("Load",function(a){d("readyState",p.DONE);d("status",Number(b.exec.call(D,"XMLHttpRequest","getStatus")||0));d("statusText",A[d("status")]||"");d("response",b.exec.call(D,"XMLHttpRequest","getResponse",d("responseType")));~g.inArray(d("responseType"),["text",""])?d("responseText",
d("response")):"document"===d("responseType")&&d("responseXML",d("response"));U=b.exec.call(D,"XMLHttpRequest","getAllResponseHeaders");h.dispatchEvent("readystatechange");0<d("status")?(x&&h.upload.dispatchEvent(a),h.dispatchEvent(a)):(R=!0,h.dispatchEvent("error"));c()});D.bind("Abort",function(a){h.dispatchEvent(a);c()});D.bind("Error",function(a){R=!0;d("readyState",p.DONE);h.dispatchEvent("readystatechange");r=!0;h.dispatchEvent(a);c()});b.exec.call(D,"XMLHttpRequest","send",{url:T,method:H,
async:C,user:O,password:G,headers:q,mimeType:K,encoding:M,responseType:h.responseType,withCredentials:h.withCredentials,options:F},a)}var h=this;(new Date).getTime();D=new f;"string"===typeof F.required_caps&&(F.required_caps=b.parseCaps(F.required_caps));F.required_caps=g.extend({},F.required_caps,{return_response_type:h.responseType});a instanceof l&&(F.required_caps.send_multipart=!0);g.isEmptyObj(q)||(F.required_caps.send_custom_headers=!0);P||(F.required_caps.do_cors=!0);F.ruid?e(D.connectRuntime(F)):
(D.bind("RuntimeInit",function(a,b){e(b)}),D.bind("RuntimeError",function(a,b){h.dispatchEvent("RuntimeError",b)}),D.connectRuntime(F))}var t=this,u={timeout:0,readyState:p.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},C=!0,T,H,q={},O,G,M=null,K=null,N=!1,y=!1,x=!1,r=!1,R=!1,P=!1,F={},D,U="",S;g.extend(this,u,{uid:g.guid("uid_"),upload:new v,open:function(b,c,f,h,l){if(!b||!c)throw new k.DOMException(k.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(b)||
e.utf8_encode(b)!==b)throw new k.DOMException(k.DOMException.SYNTAX_ERR);~g.inArray(b.toUpperCase(),"CONNECT DELETE GET HEAD OPTIONS POST PUT TRACE TRACK".split(" "))&&(H=b.toUpperCase());if(~g.inArray(H,["CONNECT","TRACE","TRACK"]))throw new k.DOMException(k.DOMException.SECURITY_ERR);c=e.utf8_encode(c);b=a.parseUrl(c);P=a.hasSameOrigin(b);T=a.resolveUrl(c);if((h||l)&&!P)throw new k.DOMException(k.DOMException.INVALID_ACCESS_ERR);O=h||b.user;G=l||b.pass;C=f||!0;if(!1===C&&(d("timeout")||d("withCredentials")||
""!==d("responseType")))throw new k.DOMException(k.DOMException.INVALID_ACCESS_ERR);N=!C;y=!1;q={};d("responseText","");d("responseXML",null);d("response",null);d("status",0);d("statusText","");d("readyState",p.OPENED);this.dispatchEvent("readystatechange")},setRequestHeader:function(a,b){if(d("readyState")!==p.OPENED||y)throw new k.DOMException(k.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(a)||e.utf8_encode(a)!==a)throw new k.DOMException(k.DOMException.SYNTAX_ERR);a=g.trim(a).toLowerCase();
if(~g.inArray(a,"accept-charset accept-encoding access-control-request-headers access-control-request-method connection content-length cookie cookie2 content-transfer-encoding date expect host keep-alive origin referer te trailer transfer-encoding upgrade user-agent via".split(" "))||/^(proxy\-|sec\-)/.test(a))return!1;q[a]=q[a]?q[a]+(", "+b):b;return!0},hasRequestHeader:function(a){return a&&q[a.toLowerCase()]||!1},getAllResponseHeaders:function(){return U||""},getResponseHeader:function(a){a=a.toLowerCase();
return R||~g.inArray(a,["set-cookie","set-cookie2"])?null:U&&""!==U&&(S||(S={},g.each(U.split(/\r\n/),function(a){a=a.split(/:\s+/);2===a.length&&(a[0]=g.trim(a[0]),S[a[0].toLowerCase()]={header:a[0],value:g.trim(a[1])})})),S.hasOwnProperty(a))?S[a].header+": "+S[a].value:null},overrideMimeType:function(a){var b;if(~g.inArray(d("readyState"),[p.LOADING,p.DONE]))throw new k.DOMException(k.DOMException.INVALID_STATE_ERR);a=g.trim(a.toLowerCase());/;/.test(a)&&(b=a.match(/^([^;]+)(?:;\scharset=)?(.*)$/))&&
(a=b[1]);if(!n.mimes[a])throw new k.DOMException(k.DOMException.SYNTAX_ERR);},send:function(a,b){F="string"===g.typeOf(b)?{ruid:b}:b?b:{};if(this.readyState!==p.OPENED||y)throw new k.DOMException(k.DOMException.INVALID_STATE_ERR);if(a instanceof c)F.ruid=a.ruid,K=a.type||"application/octet-stream";else if(a instanceof l){if(a.hasBlob()){var f=a.getBlob();F.ruid=f.ruid;K=f.type||"application/octet-stream"}}else"string"===typeof a&&(M="UTF-8",K="text/plain;charset=UTF-8",a=e.utf8_encode(a));this.withCredentials||
(this.withCredentials=F.required_caps&&F.required_caps.send_browser_cookies&&!P);x=!N&&this.upload.hasEventListener();R=!1;r=!a;N||(y=!0);h.call(this,a)},abort:function(){R=!0;N=!1;if(~g.inArray(d("readyState"),[p.UNSENT,p.OPENED,p.DONE]))d("readyState",p.UNSENT);else{d("readyState",p.DONE);y=!1;if(D)D.getRuntime().exec.call(D,"XMLHttpRequest","abort",r);else throw new k.DOMException(k.DOMException.INVALID_STATE_ERR);r=!0}},destroy:function(){D&&("function"===g.typeOf(D.destroy)&&D.destroy(),D=null);
this.unbindAll();this.upload&&(this.upload.unbindAll(),this.upload=null)}});this.handleEventProps(Q.concat(["readystatechange"]));this.upload.handleEventProps(Q)}var A={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",
306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",
426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};v.prototype=d.instance;var Q="loadstart progress abort error load timeout loadend".split(" ");p.UNSENT=0;p.OPENED=1;p.HEADERS_RECEIVED=2;p.LOADING=3;p.DONE=4;p.prototype=d.instance;return p});q("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode",
"moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(g,k,d,e){function a(){function b(b,c){var d=this;e=c;d.bind("TransportingProgress",function(b){n=b.loaded;n<m&&-1===g.inArray(d.state,[a.IDLE,a.DONE])&&f.call(d)},999);d.bind("TransportingComplete",function(){n=m;d.state=a.DONE;l=null;d.result=e.exec.call(d,"Transporter","getAsBlob",b||"")},999);d.state=a.BUSY;d.trigger("TransportingStarted");f.call(d)}function f(){var a=m-n;v>a&&(v=a);a=k.btoa(l.substr(n,v));e.exec.call(this,"Transporter",
"receive",a,m)}var c,e,l,m,n,v;d.call(this);g.extend(this,{uid:g.guid("uid_"),state:a.IDLE,result:null,transport:function(a,f,d){var e=this;d=g.extend({chunk_size:204798},d);if(c=d.chunk_size%3)d.chunk_size+=3-c;v=d.chunk_size;m=n=0;l=this.result=null;l=a;m=a.length;if("string"===g.typeOf(d)||d.ruid)b.call(e,f,this.connectRuntime(d));else{var h=function(a,c){e.unbind("RuntimeInit",h);b.call(e,f,c)};this.bind("RuntimeInit",h);this.connectRuntime(d)}},abort:function(){this.state=a.IDLE;e&&(e.exec.call(this,
"Transporter","clear"),this.trigger("TransportingAborted"));m=n=0;l=this.result=null},destroy:function(){this.unbindAll();e=null;this.disconnectRuntime();m=n=0;l=this.result=null}})}a.IDLE=0;a.BUSY=1;a.DONE=2;a.prototype=e.instance;return a});q("moxie/image/Image","moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/Exceptions moxie/file/FileReaderSync moxie/xhr/XMLHttpRequest moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/runtime/Transporter moxie/core/utils/Env moxie/core/EventTarget moxie/file/Blob moxie/file/File moxie/core/utils/Encode".split(" "),
function(g,k,d,e,a,b,f,c,h,l,m,n,v){function p(){function e(a){var b=g.typeOf(a);try{if(a instanceof p){if(!a.size)throw new d.DOMException(d.DOMException.INVALID_STATE_ERR);l.apply(this,arguments)}else if(a instanceof m){if(!~g.inArray(a.type,["image/jpeg","image/png"]))throw new d.ImageError(d.ImageError.WRONG_FORMAT);w.apply(this,arguments)}else if(-1!==g.inArray(b,["blob","file"]))e.call(this,new n(null,a),arguments[1]);else if("string"===b)"data:"===a.substr(0,5)?e.call(this,new m(null,{data:a}),
arguments[1]):t.apply(this,arguments);else if("node"===b&&"img"===a.nodeName.toLowerCase())e.call(this,a.src,arguments[1]);else throw new d.DOMException(d.DOMException.TYPE_MISMATCH_ERR);}catch(T){this.trigger("error",T.code)}}function l(a,b){var c=this.connectRuntime(a.ruid);this.ruid=c.uid;c.exec.call(this,"Image","loadFromImage",a,"undefined"===g.typeOf(b)?!0:b)}function w(a,c){function f(b){d.ruid=b.uid;b.exec.call(d,"Image","loadFromBlob",a)}var d=this;d.name=a.name||"";a.isDetached()?(this.bind("RuntimeInit",
function(a,b){f(b)}),c&&"string"===typeof c.required_caps&&(c.required_caps=b.parseCaps(c.required_caps)),this.connectRuntime(g.extend({required_caps:{access_image_binary:!0,resize_image:!0}},c))):f(this.connectRuntime(a.ruid))}function t(b,c){var f=this;var d=new a;d.open("get",b);d.responseType="blob";d.onprogress=function(a){f.trigger(a)};d.onload=function(){w.call(f,d.response,!0)};d.onerror=function(a){f.trigger(a)};d.onloadend=function(){d.destroy()};d.bind("RuntimeError",function(a,b){f.trigger("RuntimeError",
b)});d.send(null,c)}f.call(this);g.extend(this,{uid:g.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){e.apply(this,arguments)},resize:function(a){var b={x:0,y:0,width:this.width,height:this.height},c=g.extendIf({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:!1,fit:!0,preserveHeaders:!0,resample:"default",multipass:!0},a);try{if(!this.size)throw new d.DOMException(d.DOMException.INVALID_STATE_ERR);
if(this.width>p.MAX_RESIZE_WIDTH||this.height>p.MAX_RESIZE_HEIGHT)throw new d.ImageError(d.ImageError.MAX_RESOLUTION_ERR);var f=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1;if(-1!==g.inArray(f,[5,6,7,8])){var e=c.width;c.width=c.height;c.height=e}if(c.crop){var h=Math.max(c.width/this.width,c.height/this.height);a.fit?(b.width=Math.min(Math.ceil(c.width/h),this.width),b.height=Math.min(Math.ceil(c.height/h),this.height),h=c.width/b.width):(b.width=Math.min(c.width,this.width),b.height=
Math.min(c.height,this.height),h=1);"boolean"===typeof c.crop&&(c.crop="cc");switch(c.crop.toLowerCase().replace(/_/,"-")){case "rb":case "right-bottom":b.x=this.width-b.width;b.y=this.height-b.height;break;case "cb":case "center-bottom":b.x=Math.floor((this.width-b.width)/2);b.y=this.height-b.height;break;case "lb":case "left-bottom":b.x=0;b.y=this.height-b.height;break;case "lt":case "left-top":b.x=0;b.y=0;break;case "ct":case "center-top":b.x=Math.floor((this.width-b.width)/2);b.y=0;break;case "rt":case "right-top":b.x=
this.width-b.width;b.y=0;break;case "rc":case "right-center":case "right-middle":b.x=this.width-b.width;b.y=Math.floor((this.height-b.height)/2);break;case "lc":case "left-center":case "left-middle":b.x=0;b.y=Math.floor((this.height-b.height)/2);break;default:b.x=Math.floor((this.width-b.width)/2),b.y=Math.floor((this.height-b.height)/2)}b.x=Math.max(b.x,0);b.y=Math.max(b.y,0)}else h=Math.min(c.width/this.width,c.height/this.height),1<h&&!c.fit&&(h=1);this.exec("Image","resize",b,h,c)}catch(G){this.trigger("error",
G.code)}},downsize:function(a,b,c,f){var d={width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:!1,fit:!1,preserveHeaders:!0,resample:"default"};a="object"===typeof a?g.extend(d,a):g.extend(d,{width:a,height:b,crop:c,preserveHeaders:f});this.resize(a)},crop:function(a,b,c){this.downsize(a,b,!0,c)},getAsCanvas:function(){if(!h.can("create_canvas"))throw new d.RuntimeError(d.RuntimeError.NOT_SUPPORTED_ERR);return this.exec("Image","getAsCanvas")},getAsBlob:function(a,b){if(!this.size)throw new d.DOMException(d.DOMException.INVALID_STATE_ERR);
return this.exec("Image","getAsBlob",a||"image/jpeg",b||90)},getAsDataURL:function(a,b){if(!this.size)throw new d.DOMException(d.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsDataURL",a||"image/jpeg",b||90)},getAsBinaryString:function(a,b){var c=this.getAsDataURL(a,b);return v.atob(c.substring(c.indexOf("base64,")+7))},embed:function(a,b){function f(b,f){var m=this;if(h.can("create_canvas")){var n=m.getAsCanvas();if(n){a.appendChild(n);n=null;m.destroy();e.trigger("embedded");return}}n=
m.getAsDataURL(b,f);if(!n)throw new d.ImageError(d.ImageError.WRONG_FORMAT);if(h.can("use_data_uri_of",n.length))a.innerHTML='<img src="'+n+'" width="'+m.width+'" height="'+m.height+'" alt="" />',m.destroy(),e.trigger("embedded");else{var k=new c;k.bind("TransportingComplete",function(){l=e.connectRuntime(this.result.ruid);e.bind("Embedded",function(){g.extend(l.getShimContainer().style,{top:"0px",left:"0px",width:m.width+"px",height:m.height+"px"});l=null},999);l.exec.call(e,"ImageView","display",
this.result.uid,width,height);m.destroy()});k.transport(v.atob(n.substring(n.indexOf("base64,")+7)),b,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:a})}}var e=this,l,m=g.extend({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,fit:!0,resample:"nearest"},b);try{if(!(a=k.get(a)))throw new d.DOMException(d.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new d.DOMException(d.DOMException.INVALID_STATE_ERR);var n=new p;n.bind("Resize",
function(){f.call(this,m.type,m.quality)});n.bind("Load",function(){this.downsize(m)});this.meta.thumb&&this.meta.thumb.width>=m.width&&this.meta.thumb.height>=m.height?n.load(this.meta.thumb.data):n.clone(this,!1);return n}catch(M){this.trigger("error",M.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime());this.meta&&this.meta.thumb&&this.meta.thumb.data.destroy();this.unbindAll()}});this.handleEventProps(A);this.bind("Load Resize",
function(){var a=void 0;try{a||(a=this.exec("Image","getInfo"));this.size=a.size;this.width=a.width;this.height=a.height;this.type=a.type;this.meta=a.meta;""===this.name&&(this.name=a.name);var b=!0}catch(T){this.trigger("error",T.code),b=!1}return b},999)}var A=["progress","load","error","resize","embedded"];p.MAX_RESIZE_WIDTH=8192;p.MAX_RESIZE_HEIGHT=8192;p.prototype=l.instance;return p});q("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],
function(g,k,d,e){var a={};d.addConstructor("html5",function(b,f,c){var h=this,l=d.capTest,m=d.capTrue;c=g.extend({access_binary:l(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return h.can("access_binary")&&!!a.Image},display_media:l((e.can("create_canvas")||e.can("use_data_uri_over32kb"))&&!!L["moxie/image/Image"]),do_cors:l(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:l(function(){var a=document.createElement("div");return("draggable"in
a||"ondragstart"in a&&"ondrop"in a)&&("IE"!==e.browser||e.verComp(e.version,9,">"))}()),filter_by_extension:l(!("Chrome"===e.browser&&e.verComp(e.version,28,"<")||"IE"===e.browser&&e.verComp(e.version,10,"<")||"Safari"===e.browser&&e.verComp(e.version,7,"<")||"Firefox"===e.browser&&e.verComp(e.version,37,"<"))),return_response_headers:m,return_response_type:function(a){return"json"===a&&window.JSON?!0:e.can("return_response_type",a)},return_status_code:m,report_upload_progress:l(window.XMLHttpRequest&&
(new XMLHttpRequest).upload),resize_image:function(){return h.can("access_binary")&&e.can("create_canvas")},select_file:function(){return e.can("use_fileinput")&&window.File},select_folder:function(){return h.can("select_file")&&("Chrome"===e.browser&&e.verComp(e.version,21,">=")||"Firefox"===e.browser&&e.verComp(e.version,42,">="))},select_multiple:function(){return h.can("select_file")&&!("Safari"===e.browser&&"Windows"===e.os)&&!("iOS"===e.os&&e.verComp(e.osVersion,"7.0.0",">")&&e.verComp(e.osVersion,
"8.0.0","<"))},send_binary_string:l(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:l(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||h.can("send_binary_string")},slice_blob:l(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return h.can("slice_blob")&&h.can("send_multipart")},summon_file_dialog:function(){return h.can("select_file")&&
!("Firefox"===e.browser&&e.verComp(e.version,4,"<")||"Opera"===e.browser&&e.verComp(e.version,12,"<")||"IE"===e.browser&&e.verComp(e.version,10,"<"))},upload_filesize:m,use_http_method:m},c);d.call(this,b,f||"html5",c);g.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(h);a=h=null}}(this.destroy)});g.extend(this.getShim(),a)});return a});q("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(g,k){return g.Blob=function(){function d(d,
a,b){var f;if(window.File.prototype.slice)try{return d.slice(),d.slice(a,b)}catch(c){return d.slice(a,b-a)}else return(f=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?f.call(d,a,b):null}this.slice=function(){return new k(this.getRuntime().uid,d.apply(this,arguments))};this.destroy=function(){this.getRuntime().getShim().removeInstance(this.uid)}}});q("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(g){function k(){this.returnValue=!1}function d(){this.cancelBubble=
!0}var e={},a="moxie_"+g.guid(),b=function(b,c,d){c=c.toLowerCase();if(b[a]&&e[b[a]]&&e[b[a]][c]){var f=e[b[a]][c];for(var h=f.length-1;0<=h;h--)if(f[h].orig===d||f[h].key===d)if(b.removeEventListener?b.removeEventListener(c,f[h].func,!1):b.detachEvent&&b.detachEvent("on"+c,f[h].func),f[h].orig=null,f[h].func=null,f.splice(h,1),void 0!==d)break;f.length||delete e[b[a]][c];if(g.isEmptyObj(e[b[a]])){delete e[b[a]];try{delete b[a]}catch(n){b[a]=void 0}}}};return{addEvent:function(b,c,h,l){c=c.toLowerCase();
if(b.addEventListener){var f=h;b.addEventListener(c,f,!1)}else b.attachEvent&&(f=function(){var a=window.event;a.target||(a.target=a.srcElement);a.preventDefault=k;a.stopPropagation=d;h(a)},b.attachEvent("on"+c,f));b[a]||(b[a]=g.guid());e.hasOwnProperty(b[a])||(e[b[a]]={});b=e[b[a]];b.hasOwnProperty(c)||(b[c]=[]);b[c].push({func:f,orig:h,key:l})},removeEvent:b,removeAllEvents:function(d,c){d&&d[a]&&g.each(e[d[a]],function(a,f){b(d,f,c)})}}});q("moxie/runtime/html5/file/FileInput","moxie/runtime/html5/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),
function(g,k,d,e,a,b,f){return g.FileInput=function(){var c,h;d.extend(this,{init:function(l){var g=this,n=g.getRuntime(),v;c=l;l=b.extList2mimes(c.accept,n.can("filter_by_extension"));var p=n.getShimContainer();p.innerHTML='<input id="'+n.uid+'" type="file" style="font-size:999px;opacity:0;"'+(c.multiple&&n.can("select_multiple")?"multiple":"")+(c.directory&&n.can("select_folder")?"webkitdirectory directory":"")+(l?' accept="'+l.join(",")+'"':"")+" />";l=e.get(n.uid);d.extend(l.style,{position:"absolute",
top:0,left:0,width:"100%",height:"100%"});var A=e.get(c.browse_button);h=e.getStyle(A,"z-index")||"auto";n.can("summon_file_dialog")&&("static"===e.getStyle(A,"position")&&(A.style.position="relative"),a.addEvent(A,"click",function(a){var b=e.get(n.uid);b&&!b.disabled&&b.click();a.preventDefault()},g.uid),g.bind("Refresh",function(){v=parseInt(h,10)||1;e.get(c.browse_button).style.zIndex=v;this.getRuntime().getShimContainer().style.zIndex=v-1}));p=n.can("summon_file_dialog")?A:p;a.addEvent(p,"mouseover",
function(){g.trigger("mouseenter")},g.uid);a.addEvent(p,"mouseout",function(){g.trigger("mouseleave")},g.uid);a.addEvent(p,"mousedown",function(){g.trigger("mousedown")},g.uid);a.addEvent(e.get(c.container),"mouseup",function(){g.trigger("mouseup")},g.uid);(n.can("summon_file_dialog")?l:A).setAttribute("tabindex",-1);l.onchange=function B(){g.files=[];d.each(this.files,function(a){var b="";if(c.directory&&"."==a.name)return!0;a.webkitRelativePath&&(b="/"+a.webkitRelativePath.replace(/^\//,""));a=
new k(n.uid,a);a.relativePath=b;g.files.push(a)});if("IE"!==f.browser&&"IEMobile"!==f.browser)this.value="";else{var a=this.cloneNode(!0);this.parentNode.replaceChild(a,this);a.onchange=B}g.files.length&&g.trigger("change")};g.trigger({type:"ready",async:!0});p=null},setOption:function(a,c){var d=this.getRuntime(),f=e.get(d.uid);switch(a){case "accept":c?(d=c.mimes||b.extList2mimes(c,d.can("filter_by_extension")),f.setAttribute("accept",d.join(","))):f.removeAttribute("accept");break;case "directory":c&&
d.can("select_folder")?(f.setAttribute("directory",""),f.setAttribute("webkitdirectory","")):(f.removeAttribute("directory"),f.removeAttribute("webkitdirectory"));break;case "multiple":c&&d.can("select_multiple")?f.setAttribute("multiple",""):f.removeAttribute("multiple")}},disable:function(a){var b=this.getRuntime();if(b=e.get(b.uid))b.disabled=!!a},destroy:function(){var b=this.getRuntime(),d=b.getShim();b=b.getShimContainer();var f=c&&e.get(c.container),g=c&&e.get(c.browse_button);f&&a.removeAllEvents(f,
this.uid);g&&(a.removeAllEvents(g,this.uid),g.style.zIndex=h);b&&(a.removeAllEvents(b,this.uid),b.innerHTML="");d.removeInstance(this.uid);c=null}})}});q("moxie/runtime/html5/file/FileDrop","moxie/runtime/html5/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime".split(" "),function(g,k,d,e,a,b){return g.FileDrop=function(){function f(a){if(!a.dataTransfer||!a.dataTransfer.types)return!1;a=d.toArray(a.dataTransfer.types||[]);return-1!==
d.inArray("Files",a)||-1!==d.inArray("public.file-url",a)||-1!==d.inArray("application/x-moz-file",a)}function c(a,c){if(A.length){var f=b.getFileExtension(a.name);f=!f||-1!==d.inArray(f,A)}else f=!0;f&&(f=new k(B,a),f.relativePath=c||"",p.push(f))}function h(a){for(var b=[],c=0;c<a.length;c++)[].push.apply(b,a[c].extensions.split(/\s*,\s*/));return-1===d.inArray("*",b)?b:[]}function g(a,b){var f=[];d.each(a,function(a){var b=a.webkitGetAsEntry();b&&(b.isFile?c(a.getAsFile(),b.fullPath):f.push(b))});
f.length?m(f,b):b()}function m(a,b){var c=[];d.each(a,function(a){c.push(function(b){n(a,b)})});d.inSeries(c,function(){b()})}function n(a,b){a.isFile?a.file(function(d){c(d,a.fullPath);b()},function(){b()}):a.isDirectory?v(a,b):b()}function v(a,b){function c(a){f.readEntries(function(b){b.length?([].push.apply(d,b),c(a)):a()},a)}var d=[],f=a.createReader();c(function(){m(d,b)})}var p=[],A=[],q,B;d.extend(this,{init:function(b){var e=this;q=b;B=e.ruid;A=h(q.accept);b=q.container;a.addEvent(b,"dragover",
function(a){f(a)&&(a.preventDefault(),a.dataTransfer.dropEffect="copy")},e.uid);a.addEvent(b,"drop",function(a){f(a)&&(a.preventDefault(),p=[],a.dataTransfer.items&&a.dataTransfer.items[0].webkitGetAsEntry?g(a.dataTransfer.items,function(){e.files=p;e.trigger("drop")}):(d.each(a.dataTransfer.files,function(a){c(a)}),e.files=p,e.trigger("drop")))},e.uid);a.addEvent(b,"dragenter",function(a){e.trigger("dragenter")},e.uid);a.addEvent(b,"dragleave",function(a){e.trigger("dragleave")},e.uid)},destroy:function(){a.removeAllEvents(q&&
e.get(q.container),this.uid);B=p=A=q=null;this.getRuntime().getShim().removeInstance(this.uid)}})}});q("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(g,k,d){return g.FileReader=function(){var e,a=!1;d.extend(this,{read:function(b,f){var c=this;c.result="";e=new window.FileReader;e.addEventListener("progress",function(a){c.trigger(a)});e.addEventListener("load",function(b){if(a){var d=e.result;d=k.atob(d.substring(d.indexOf("base64,")+
7))}else d=e.result;c.result=d;c.trigger(b)});e.addEventListener("error",function(a){c.trigger(a,e.error)});e.addEventListener("loadend",function(a){e=null;c.trigger(a)});"function"===d.typeOf(e[b])?(a=!1,e[b](f.getSource())):"readAsBinaryString"===b&&(a=!0,e.readAsDataURL(f.getSource()))},abort:function(){e&&e.abort()},destroy:function(){e=null;this.getRuntime().getShim().removeInstance(this.uid)}})}});q("moxie/runtime/html5/xhr/XMLHttpRequest","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/utils/Mime moxie/core/utils/Url moxie/file/File moxie/file/Blob moxie/xhr/FormData moxie/core/Exceptions moxie/core/utils/Env".split(" "),
function(g,k,d,e,a,b,f,c,h){return g.XMLHttpRequest=function(){function g(a,c){var d=this;var f=c.getBlob().getSource();var e=new window.FileReader;e.onload=function(){c.append(c.getBlobName(),new b(null,{type:f.type,data:e.result}));v.send.call(d,a,c)};e.readAsBinaryString(f)}function m(){if(!window.XMLHttpRequest||"IE"===h.browser&&h.verComp(h.version,8,"<")){a:{for(var a=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],b=0;b<a.length;b++)try{var c=new ActiveXObject(a[b]);break a}catch(t){}c=void 0}return c}return new window.XMLHttpRequest}
function n(a){var d="----moxieboundary"+(new Date).getTime(),f="";if(!this.getRuntime().can("send_binary_string"))throw new c.RuntimeError(c.RuntimeError.NOT_SUPPORTED_ERR);p.setRequestHeader("Content-Type","multipart/form-data; boundary="+d);a.each(function(a,c){f=a instanceof b?f+("--"+d+'\r\nContent-Disposition: form-data; name="'+c+'"; filename="'+unescape(encodeURIComponent(a.name||"blob"))+'"\r\nContent-Type: '+(a.type||"application/octet-stream")+"\r\n\r\n"+a.getSource()+"\r\n"):f+("--"+d+
'\r\nContent-Disposition: form-data; name="'+c+'"\r\n\r\n'+unescape(encodeURIComponent(a))+"\r\n")});return f+="--"+d+"--\r\n"}var v=this,p,A;k.extend(this,{send:function(a,c){var d=this,l="Mozilla"===h.browser&&h.verComp(h.version,4,">=")&&h.verComp(h.version,7,"<"),v="Android Browser"===h.browser,q=!1;A=a.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase();p=m();p.open(a.method,a.url,a.async,a.user,a.password);if(c instanceof b)c.isDetached()&&(q=!0),c=c.getSource();else if(c instanceof f){if(c.hasBlob())if(c.getBlob().isDetached())c=
n.call(d,c),q=!0;else if((l||v)&&"blob"===k.typeOf(c.getBlob().getSource())&&window.FileReader){g.call(d,a,c);return}if(c instanceof f){var B=new window.FormData;c.each(function(a,c){a instanceof b?B.append(c,a.getSource()):B.append(c,a)});c=B}}p.upload?(a.withCredentials&&(p.withCredentials=!0),p.addEventListener("load",function(a){d.trigger(a)}),p.addEventListener("error",function(a){d.trigger(a)}),p.addEventListener("progress",function(a){d.trigger(a)}),p.upload.addEventListener("progress",function(a){d.trigger({type:"UploadProgress",
loaded:a.loaded,total:a.total})})):p.onreadystatechange=function(){switch(p.readyState){case 3:var b;try{if(e.hasSameOrigin(a.url)&&(b=p.getResponseHeader("Content-Length")||0),p.responseText)var c=p.responseText.length}catch(O){b=c=0}d.trigger({type:"progress",lengthComputable:!!b,total:parseInt(b,10),loaded:c});break;case 4:p.onreadystatechange=function(){};try{if(200<=p.status&&400>p.status){d.trigger("load");break}}catch(O){}d.trigger("error")}};k.isEmptyObj(a.headers)||k.each(a.headers,function(a,
b){p.setRequestHeader(b,a)});""!==a.responseType&&"responseType"in p&&("json"!==a.responseType||h.can("return_response_type","json")?p.responseType=a.responseType:p.responseType="text");q?p.sendAsBinary?p.sendAsBinary(c):function(){for(var a=new Uint8Array(c.length),b=0;b<c.length;b++)a[b]=c.charCodeAt(b)&255;p.send(a.buffer)}():p.send(c);d.trigger("loadstart")},getStatus:function(){try{if(p)return p.status}catch(Q){}return 0},getResponse:function(b){var c=this.getRuntime();try{switch(b){case "blob":var f=
new a(c.uid,p.response),e=p.getResponseHeader("Content-Disposition");if(e){var g=e.match(/filename=(['"'])([^\1]+)\1/);g&&(A=g[2])}f.name=A;f.type||(f.type=d.getFileMime(A));return f;case "json":return h.can("return_response_type","json")?p.response:200===p.status&&window.JSON?JSON.parse(p.responseText):null;case "document":var l=p.responseXML,k=p.responseText;"IE"===h.browser&&k&&l&&!l.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(p.getResponseHeader("Content-Type"))&&(l=new window.ActiveXObject("Microsoft.XMLDOM"),
l.async=!1,l.validateOnParse=!1,l.loadXML(k));var n=l&&("IE"===h.browser&&0!==l.parseError||!l.documentElement||"parsererror"===l.documentElement.tagName)?null:l;return n;default:return""!==p.responseText?p.responseText:null}}catch(z){return null}},getAllResponseHeaders:function(){try{return p.getAllResponseHeaders()}catch(Q){}return""},abort:function(){p&&p.abort()},destroy:function(){v=A=null;null!=this.getRuntime()&&this.getRuntime().getShim().removeInstance(this.uid)}})}});q("moxie/runtime/html5/utils/BinaryReader",
["moxie/core/utils/Basic"],function(g){function k(a){a instanceof ArrayBuffer?d.apply(this,arguments):e.apply(this,arguments)}function d(a){var b=new DataView(a);g.extend(this,{readByteAt:function(a){return b.getUint8(a)},writeByteAt:function(a,c){b.setUint8(a,c)},SEGMENT:function(d,c,e){switch(arguments.length){case 2:return a.slice(d,d+c);case 1:return a.slice(d);case 3:if(null===e&&(e=new ArrayBuffer),e instanceof ArrayBuffer){var f=new Uint8Array(this.length()-c+e.byteLength);0<d&&f.set(new Uint8Array(a.slice(0,
d)),0);f.set(new Uint8Array(e),d);f.set(new Uint8Array(a.slice(d+c)),d+e.byteLength);this.clear();a=f.buffer;b=new DataView(a);break}default:return a}},length:function(){return a?a.byteLength:0},clear:function(){b=a=null}})}function e(a){function b(b,c,d){d=3===arguments.length?d:a.length-c-1;a=a.substr(0,c)+b+a.substr(d+c)}g.extend(this,{readByteAt:function(b){return a.charCodeAt(b)},writeByteAt:function(a,c){b(String.fromCharCode(c),a,1)},SEGMENT:function(d,c,e){switch(arguments.length){case 1:return a.substr(d);
case 2:return a.substr(d,c);case 3:b(null!==e?e:"",d,c);break;default:return a}},length:function(){return a?a.length:0},clear:function(){a=null}})}g.extend(k.prototype,{littleEndian:!1,read:function(a,b){var d,c;if(a+b>this.length())throw Error("You are trying to read outside the source boundaries.");var e=this.littleEndian?0:-8*(b-1);for(d=c=0;c<b;c++)d|=this.readByteAt(a+c)<<Math.abs(e+8*c);return d},write:function(a,b,d){var c;if(a>this.length())throw Error("You are trying to write outside the source boundaries.");
var f=this.littleEndian?0:-8*(d-1);for(c=0;c<d;c++)this.writeByteAt(a+c,b>>Math.abs(f+8*c)&255)},BYTE:function(a){return this.read(a,1)},SHORT:function(a){return this.read(a,2)},LONG:function(a){return this.read(a,4)},SLONG:function(a){a=this.read(a,4);return 2147483647<a?a-4294967296:a},CHAR:function(a){return String.fromCharCode(this.read(a,1))},STRING:function(a,b){return this.asArray("CHAR",a,b).join("")},asArray:function(a,b,d){for(var c=[],f=0;f<d;f++)c[f]=this[a](b+f);return c}});return k});
q("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(g,k){return function a(e){var b=[],f,c=0;e=new g(e);if(65496!==e.SHORT(0))throw e.clear(),new k.ImageError(k.ImageError.WRONG_FORMAT);for(f=2;f<=e.length();){var h=e.SHORT(f);if(65488<=h&&65495>=h)f+=2;else{if(65498===h||65497===h)break;c=e.SHORT(f+2)+2;65505<=h&&65519>=h&&b.push({hex:h,name:"APP"+(h&15),start:f,length:c,segment:e.SEGMENT(f,c)});f+=c}}e.clear();return{headers:b,restore:function(a){var c=
new g(a);f=65504==c.SHORT(2)?4+c.SHORT(4):2;var e=0;for(a=b.length;e<a;e++)c.SEGMENT(f,0,b[e].segment),f+=b[e].length;a=c.SEGMENT();c.clear();return a},strip:function(b){var c=new a(b);var f=c.headers;c.purge();c=new g(b);for(b=f.length;b--;)c.SEGMENT(f[b].start,f[b].length,"");b=c.SEGMENT();c.clear();return b},get:function(a){for(var c=[],f=0,e=b.length;f<e;f++)b[f].name===a.toUpperCase()&&c.push(b[f].segment);return c},set:function(a,c){var f=[],e,h;"string"===typeof c?f.push(c):f=c;var g=e=0;for(h=
b.length;g<h&&!(b[g].name===a.toUpperCase()&&(b[g].segment=f[e],b[g].length=f[e].length,e++),e>=f.length);g++);},purge:function(){this.headers=b=[]}}}});q("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(g,k,d){function e(a){function b(a,b){var f,e={},l={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},k={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,
SRATIONAL:8};var n=this.SHORT(a);for(f=0;f<n;f++){var m=a+2+12*f;var p=b[this.SHORT(m)];if(p!==I){var v=l[this.SHORT(m+=2)];var q=this.LONG(m+=2);var z=k[v];if(!z)throw new d.ImageError(d.ImageError.INVALID_META_ERR);m+=4;4<z*q&&(m=this.LONG(m)+h.tiffHeader);if(m+z*q>=this.length())throw new d.ImageError(d.ImageError.INVALID_META_ERR);"ASCII"===v?e[p]=g.trim(this.STRING(m,q).replace(/\0$/,"")):(v=this.asArray(v,m,q),q=1==q?v[0]:v,c.hasOwnProperty(p)&&"object"!=typeof q?e[p]=c[p][q]:e[p]=q)}}return e}
k.call(this,a);var f={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",
41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}};var c={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",
9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",
13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",
73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",
2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};var h={tiffHeader:10};var l=h.tiffHeader;var m={clear:this.clear};g.extend(this,{read:function(){try{return e.prototype.read.apply(this,
arguments)}catch(v){throw new d.ImageError(d.ImageError.INVALID_META_ERR);}},write:function(){try{return e.prototype.write.apply(this,arguments)}catch(v){throw new d.ImageError(d.ImageError.INVALID_META_ERR);}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(a){return this.LONG(a)/this.LONG(a+4)},SRATIONAL:function(a){return this.SLONG(a)/this.SLONG(a+4)},ASCII:function(a){return this.CHAR(a)},TIFF:function(){return n||null},EXIF:function(){var a=null;if(h.exifIFD){try{a=
b.call(this,h.exifIFD,f.exif)}catch(Q){return null}if(a.ExifVersion&&"array"===g.typeOf(a.ExifVersion)){for(var c=0,d="";c<a.ExifVersion.length;c++)d+=String.fromCharCode(a.ExifVersion[c]);a.ExifVersion=d}}return a},GPS:function(){var a=null;if(h.gpsIFD){try{a=b.call(this,h.gpsIFD,f.gps)}catch(p){return null}a.GPSVersionID&&"array"===g.typeOf(a.GPSVersionID)&&(a.GPSVersionID=a.GPSVersionID.join("."))}return a},thumb:function(){if(h.IFD1)try{var a=b.call(this,h.IFD1,f.thumb);if("JPEGInterchangeFormat"in
a)return this.SEGMENT(h.tiffHeader+a.JPEGInterchangeFormat,a.JPEGInterchangeFormatLength)}catch(p){}return null},setExif:function(a,b){if("PixelXDimension"!==a&&"PixelYDimension"!==a)return!1;a:{var c=a;var d=0;if("string"===typeof c){var e=f.exif;for(g in e)if(e[g]===c){c=g;break}}e=h.exifIFD;var g=this.SHORT(e);for(var l=0;l<g;l++){var k=e+12*l+2;if(this.SHORT(k)==c){d=k+8;break}}if(d){try{this.write(d,b,4)}catch(C){c=!1;break a}c=!0}else c=!1}return c},clear:function(){m.clear();a=f=c=n=h=m=null}});
if(65505!==this.SHORT(0)||"EXIF\x00"!==this.STRING(4,5).toUpperCase())throw new d.ImageError(d.ImageError.INVALID_META_ERR);this.littleEndian=18761==this.SHORT(l);if(42!==this.SHORT(l+=2))throw new d.ImageError(d.ImageError.INVALID_META_ERR);h.IFD0=h.tiffHeader+this.LONG(l+=2);var n=b.call(this,h.IFD0,f.tiff);"ExifIFDPointer"in n&&(h.exifIFD=h.tiffHeader+n.ExifIFDPointer,delete n.ExifIFDPointer);"GPSInfoIFDPointer"in n&&(h.gpsIFD=h.tiffHeader+n.GPSInfoIFDPointer,delete n.GPSInfoIFDPointer);g.isEmptyObj(n)&&
(n=null);if(l=this.LONG(h.IFD0+12*this.SHORT(h.IFD0)+2))h.IFD1=h.tiffHeader+l}e.prototype=k.prototype;return e});q("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(g,k,d,e,a){return function(b){function f(a){var b=0;for(a||(a=h);b<=a.length();){var c=a.SHORT(b+=2);if(65472<=c&&65475>=c)return b+=5,{height:a.SHORT(b),width:a.SHORT(b+2)};
c=a.SHORT(b+=2);b+=c-2}return null}function c(){var a=m.thumb();if(a){var b=new e(a);var c=f(b);b.clear();if(c)return c.data=a,c}return null}var h=new e(b);if(65496!==h.SHORT(0))throw new k.ImageError(k.ImageError.WRONG_FORMAT);var l=new d(b);try{var m=new a(l.get("app1")[0])}catch(v){}var n=f.call(this);g.extend(this,{type:"image/jpeg",size:h.length(),width:n&&n.width||0,height:n&&n.height||0,setExif:function(a,b){if(!m)return!1;"object"===g.typeOf(a)?g.each(a,function(a,b){m.setExif(b,a)}):m.setExif(a,
b);l.set("app1",m.SEGMENT())},writeHeaders:function(){return arguments.length?l.restore(arguments[0]):l.restore(b)},stripHeaders:function(a){return l.strip(a)},purge:function(){m&&l&&h&&(m.clear(),l.purge(),h.clear(),n=l=m=h=null)}});m&&(this.meta={tiff:m.TIFF(),exif:m.EXIF(),gps:m.GPS(),thumb:c()})}});q("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(g,k,d){return function(e){function a(){b&&(b.clear(),e=f=b=null)}
var b=new d(e);(function(){var a=0,d,f=[35152,20039,3338,6666];for(d=0;d<f.length;d++,a+=2)if(f[d]!=b.SHORT(a))throw new g.ImageError(g.ImageError.WRONG_FORMAT);})();var f=function(){var a=8;var d=b.LONG(a);var f=b.STRING(a+=4,4);var e=a+=4;b.LONG(a+d);return"IHDR"==f?{width:b.LONG(e),height:b.LONG(e+4)}:null}.call(this);k.extend(this,{type:"image/png",size:b.length(),width:f.width,height:f.height,purge:function(){a.call(this)}});a.call(this)}});q("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic",
"moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(g,k,d,e){return function(a){var b=[d,e];var f=function(){for(var c=0;c<b.length;c++)try{return new b[c](a)}catch(h){}throw new k.ImageError(k.ImageError.WRONG_FORMAT);}();g.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(a){return a},stripHeaders:function(a){return a},purge:function(){a=null}});g.extend(this,f);this.purge=function(){f.purge();f=null}}});q("moxie/runtime/html5/image/ResizerCanvas",
[],function(){function g(k,d,e){var a=k.width>k.height?"width":"height",b=Math.round(k[a]*d),f=!1;"nearest"!==e&&(.5>d||2<d)&&(d=.5>d?.5:2,f=!0);var c=k.width,h=k.height,l=Math.round(c*d);d=Math.round(h*d);var m=document.createElement("canvas");m.width=l;m.height=d;m.getContext("2d").drawImage(k,0,0,c,h,0,0,l,d);return f?g(m,b/m[a],e):m}return{scale:g}});q("moxie/runtime/html5/image/Image","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/Exceptions moxie/core/utils/Encode moxie/file/Blob moxie/file/File moxie/runtime/html5/image/ImageInfo moxie/runtime/html5/image/ResizerCanvas moxie/core/utils/Mime moxie/core/utils/Env".split(" "),
function(g,k,d,e,a,b,f,c,h,l){return g.Image=function(){function g(){if(!u&&!w)throw new d.ImageError(d.DOMException.INVALID_STATE_ERR);return u||w}function l(){var a=g();if("canvas"==a.nodeName.toLowerCase())return a;u=document.createElement("canvas");u.width=a.width;u.height=a.height;u.getContext("2d").drawImage(a,0,0);return u}function v(a){return e.atob(a.substring(a.indexOf("base64,")+7))}function p(a){var b=this;w=new Image;w.onerror=function(){Q.call(this);b.trigger("error",d.ImageError.WRONG_FORMAT)};
w.onload=function(){b.trigger("load")};w.src="data:"==a.substr(0,5)?a:"data:"+(r.type||"")+";base64,"+e.btoa(a)}function q(a,b){var c=this;if(window.FileReader){var f=new FileReader;f.onload=function(){b.call(c,this.result)};f.onerror=function(){c.trigger("error",d.ImageError.WRONG_FORMAT)};f.readAsDataURL(a)}else return b.call(this,a.getAsDataURL())}function Q(){t&&(t.purge(),t=null);C=w=u=r=null;H=!1}var B=this,w,t,u,C,r,H=!1,z=!0;k.extend(this,{loadFromBlob:function(a){var b=this.getRuntime(),
c=1<arguments.length?arguments[1]:!0;if(!b.can("access_binary"))throw new d.RuntimeError(d.RuntimeError.NOT_SUPPORTED_ERR);r=a;a.isDetached()?(C=a.getSource(),p.call(this,C)):q.call(this,a.getSource(),function(a){c&&(C=v(a));p.call(this,a)})},loadFromImage:function(a,c){this.meta=a.meta;r=new b(null,{name:a.name,size:a.size,type:a.type});p.call(this,c?C=a.getAsBinaryString():a.getAsDataURL())},getInfo:function(){var b=this.getRuntime();!t&&C&&b.can("access_image_binary")&&(t=new f(C));b={width:g().width||
0,height:g().height||0,type:r.type||h.getFileMime(r.name),size:C&&C.length||r.size||0,name:r.name||"",meta:null};z&&(b.meta=t&&t.meta||this.meta||{},!b.meta||!b.meta.thumb||b.meta.thumb.data instanceof a||(b.meta.thumb.data=new a(null,{type:"image/jpeg",data:b.meta.thumb.data})));return b},resize:function(a,b,d){var f=document.createElement("canvas");f.width=a.width;f.height=a.height;f.getContext("2d").drawImage(g(),a.x,a.y,a.width,a.height,0,0,f.width,f.height);u=c.scale(f,b);z=d.preserveHeaders;
if(!z){a=u;b=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1;d=Math.PI/180;f=document.createElement("canvas");var e=f.getContext("2d"),h=a.width,l=a.height;-1<k.inArray(b,[5,6,7,8])?(f.width=l,f.height=h):(f.width=h,f.height=l);switch(b){case 2:e.translate(h,0);e.scale(-1,1);break;case 3:e.translate(h,l);e.rotate(180*d);break;case 4:e.translate(0,l);e.scale(1,-1);break;case 5:e.rotate(90*d);e.scale(1,-1);break;case 6:e.rotate(90*d);e.translate(0,-l);break;case 7:e.rotate(90*d);e.translate(h,
-l);e.scale(-1,1);break;case 8:e.rotate(-90*d),e.translate(-h,0)}e.drawImage(a,0,0,h,l);u=f}this.width=u.width;this.height=u.height;H=!0;this.trigger("Resize")},getAsCanvas:function(){u||(u=l());u.id=this.uid+"_canvas";return u},getAsBlob:function(a,c){return a!==this.type?(H=!0,new b(null,{name:r.name||"",type:a,data:B.getAsDataURL(a,c)})):new b(null,{name:r.name||"",type:a,data:B.getAsBinaryString(a,c)})},getAsDataURL:function(a,b){var c=b||90;if(!H)return w.src;l();if("image/jpeg"!==a)return u.toDataURL("image/png");
try{return u.toDataURL("image/jpeg",c/100)}catch(K){return u.toDataURL("image/jpeg")}},getAsBinaryString:function(a,b){if(!H)return C||(C=v(B.getAsDataURL(a,b))),C;if("image/jpeg"!==a)C=v(B.getAsDataURL(a,b));else{b||(b=90);l();try{var c=u.toDataURL("image/jpeg",b/100)}catch(K){c=u.toDataURL("image/jpeg")}C=v(c);t&&(C=t.stripHeaders(C),z&&(t.meta&&t.meta.exif&&t.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),C=t.writeHeaders(C)),t.purge(),t=null)}H=!1;return C},destroy:function(){B=
null;Q.call(this);this.getRuntime().getShim().removeInstance(this.uid)}})}});q("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(g,k,d,e,a){function b(){try{var a=navigator.plugins["Shockwave Flash"];a=a.description}catch(l){try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(m){a="0.0"}}a=a.match(/\d+/g);return parseFloat(a[0]+"."+a[1])}function f(a){var b=
d.get(a);b&&"OBJECT"==b.nodeName&&("IE"===k.browser?(b.style.display="none",function n(){if(4==b.readyState){var c=d.get(a);if(c){for(var f in c)"function"==typeof c[f]&&(c[f]=null);c.parentNode.removeChild(c)}}else setTimeout(n,10)}()):b.parentNode.removeChild(b))}var c={};a.addConstructor("flash",function(h){var l=this,m;h=g.extend({swf_url:k.swf_url},h);a.call(this,h,"flash",{access_binary:function(a){return a&&"browser"===l.mode},access_image_binary:function(a){return a&&"browser"===l.mode},display_media:a.capTest(!!L["moxie/image/Image"]),
do_cors:a.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===l.mode},resize_image:a.capTrue,return_response_headers:!1,return_response_type:function(a){return"json"===a&&window.JSON?!0:!g.arrayDiff(a,["","text","document"])||"browser"===l.mode},return_status_code:function(a){return"browser"===l.mode||!g.arrayDiff(a,[200,404])},select_file:a.capTrue,select_multiple:a.capTrue,send_binary_string:function(a){return a&&"browser"===l.mode},send_browser_cookies:function(a){return a&&
"browser"===l.mode},send_custom_headers:function(a){return a&&"browser"===l.mode},send_multipart:a.capTrue,slice_blob:function(a){return a&&"browser"===l.mode},stream_upload:function(a){return a&&"browser"===l.mode},summon_file_dialog:!1,upload_filesize:function(a){return 2097152>=g.parseSizeStr(a)||"client"===l.mode},use_http_method:function(a){return!g.arrayDiff(a,["GET","POST"])}},{access_binary:function(a){return a?"browser":"client"},access_image_binary:function(a){return a?"browser":"client"},
report_upload_progress:function(a){return a?"browser":"client"},return_response_type:function(a){return g.arrayDiff(a,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(a){return g.arrayDiff(a,[200,404])?"browser":["client","browser"]},send_binary_string:function(a){return a?"browser":"client"},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?"browser":"client"},slice_blob:function(a){return a?"browser":
"client"},stream_upload:function(a){return a?"client":"browser"},upload_filesize:function(a){return 2097152<=g.parseSizeStr(a)?"client":"browser"}},"client");11.3>b()&&(MXI_DEBUG&&k.debug.runtime&&k.log("\tFlash didn't meet minimal version requirement (11.3)."),this.mode=!1);g.extend(this,{getShim:function(){return d.get(this.uid)},shimExec:function(a,b){var c=[].slice.call(arguments,2);return l.getShim().exec(this.uid,a,b,c)},init:function(){var b=this.getShimContainer();g.extend(b.style,{position:"absolute",
top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});var c='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+h.swf_url+'" ';"IE"===k.browser&&(c+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');c+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+h.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+a.getGlobalEventTarget()+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';
if("IE"===k.browser){var d=document.createElement("div");b.appendChild(d);d.outerHTML=c;d=b=null}else b.innerHTML=c;m=setTimeout(function(){l&&!l.initialized&&(l.trigger("Error",new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)),MXI_DEBUG&&k.debug.runtime&&k.log("\tFlash failed to initialize within a specified period of time (typically 5s)."))},5E3)},destroy:function(a){return function(){f(l.uid);a.call(l);clearTimeout(m);h=m=a=l=null}}(this.destroy)},c)});return c});q("moxie/runtime/flash/file/Blob",
["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(g,k){return g.Blob={slice:function(d,e,a,b){var f=this.getRuntime();0>e?e=Math.max(d.size+e,0):0<e&&(e=Math.min(e,d.size));0>a?a=Math.max(d.size+a,0):0<a&&(a=Math.min(a,d.size));(d=f.shimExec.call(this,"Blob","slice",e,a,b||""))&&(d=new k(f.uid,d));return d}}});q("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime","moxie/file/File","moxie/core/utils/Dom","moxie/core/utils/Basic"],function(g,k,d,e){return g.FileInput={init:function(a){var b=
this,f=this.getRuntime(),c=d.get(a.browse_button);c&&(c.setAttribute("tabindex",-1),c=null);this.bind("Change",function(){var a=f.shimExec.call(b,"FileInput","getFiles");b.files=[];e.each(a,function(a){b.files.push(new k(f.uid,a))})},999);this.getRuntime().shimExec.call(this,"FileInput","init",{accept:a.accept,multiple:a.multiple});this.trigger("ready")}}});q("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(g,k){function d(d,a){switch(a){case "readAsText":return k.atob(d,
"utf8");case "readAsBinaryString":return k.atob(d);case "readAsDataURL":return d}return null}return g.FileReader={read:function(e,a){var b=this;b.result="";"readAsDataURL"===e&&(b.result="data:"+(a.type||"")+";base64,");b.bind("Progress",function(a,c){c&&(b.result+=d(c,e))},999);return b.getRuntime().shimExec.call(this,"FileReader","readAsBase64",a.uid)}}});q("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(g,k){function d(d,a){switch(a){case "readAsText":return k.atob(d,
"utf8");case "readAsBinaryString":return k.atob(d);case "readAsDataURL":return d}return null}return g.FileReaderSync={read:function(e,a){var b=this.getRuntime().shimExec.call(this,"FileReaderSync","readAsBase64",a.uid);if(!b)return null;"readAsDataURL"===e&&(b="data:"+(a.type||"")+";base64,"+b);return d(b,e,a.type)}}});q("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(g,k){return g.Transporter={getAsBlob:function(d){var e=this.getRuntime();return(d=
e.shimExec.call(this,"Transporter","getAsBlob",d))?new k(e.uid,d):null}}});q("moxie/runtime/flash/xhr/XMLHttpRequest","moxie/runtime/flash/Runtime moxie/core/utils/Basic moxie/file/Blob moxie/file/File moxie/file/FileReaderSync moxie/runtime/flash/file/FileReaderSync moxie/xhr/FormData moxie/runtime/Transporter moxie/runtime/flash/runtime/Transporter".split(" "),function(g,k,d,e,a,b,f,c,h){return g.XMLHttpRequest={send:function(a,b){function e(){a.transport=m.mode;m.shimExec.call(l,"XMLHttpRequest",
"send",a,b)}function h(a,c){m.shimExec.call(l,"XMLHttpRequest","appendBlob",a,c.uid);b=null;e()}function g(a,b){var d=new c;d.bind("TransportingComplete",function(){b(this.result)});d.transport(a.getSource(),a.type,{ruid:m.uid})}var l=this,m=l.getRuntime();k.isEmptyObj(a.headers)||k.each(a.headers,function(a,b){m.shimExec.call(l,"XMLHttpRequest","setRequestHeader",b,a.toString())});if(b instanceof f){var q;b.each(function(a,b){a instanceof d?q=b:m.shimExec.call(l,"XMLHttpRequest","append",b,a)});
if(b.hasBlob()){var w=b.getBlob();w.isDetached()?g(w,function(a){w.destroy();h(q,a)}):h(q,w)}else b=null,e()}else b instanceof d?b.isDetached()?g(b,function(a){b.destroy();b=a.uid;e()}):(b=b.uid,e()):e()},getResponse:function(b){var c,d=this.getRuntime();if(c=d.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){c=new e(d.uid,c);if("blob"===b)return c;try{var f=new a;if(~k.inArray(b,["","text"]))return f.readAsText(c);if("json"===b&&window.JSON)return JSON.parse(f.readAsText(c))}finally{c.destroy()}}return null},
abort:function(a){this.getRuntime().shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort")}}});q("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(g,k,d,e,a){return g.Image={loadFromBlob:function(a){function b(a){e.shimExec.call(c,"Image","loadFromBlob",a.uid);c=e=null}var c=this,e=c.getRuntime();if(a.isDetached()){var g=
new d;g.bind("TransportingComplete",function(){b(g.result.getSource())});g.transport(a.getSource(),a.type,{ruid:e.uid})}else b(a.getSource())},loadFromImage:function(a){return this.getRuntime().shimExec.call(this,"Image","loadFromImage",a.uid)},getInfo:function(){var a=this.getRuntime(),d=a.shimExec.call(this,"Image","getInfo");d.meta&&d.meta.thumb&&d.meta.thumb.data&&!(a.meta.thumb.data instanceof e)&&(d.meta.thumb.data=new e(a.uid,d.meta.thumb.data));return d},getAsBlob:function(a,d){var b=this.getRuntime(),
f=b.shimExec.call(this,"Image","getAsBlob",a,d);return f?new e(b.uid,f):null},getAsDataURL:function(){var b=this.getRuntime().Image.getAsBlob.apply(this,arguments);return b?(new a).readAsDataURL(b):null}}});q("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(g,k,d,e,a){function b(a){var b=!1,c=null,d,f,e=0;try{try{c=new ActiveXObject("AgControl.AgControl"),c.IsVersionSupported(a)&&(b=
!0)}catch(w){var g=navigator.plugins["Silverlight Plug-In"];if(g){var k=g.description;"1.0.30226.2"===k&&(k="2.0.30226.2");for(d=k.split(".");3<d.length;)d.pop();for(;4>d.length;)d.push(0);for(f=a.split(".");4<f.length;)f.pop();do{var q=parseInt(f[e],10);var B=parseInt(d[e],10);e++}while(e<f.length&&q===B);q<=B&&!isNaN(q)&&(b=!0)}}}catch(w){b=!1}return b}var f={};a.addConstructor("silverlight",function(c){var h=this,l;c=g.extend({xap_url:k.xap_url},c);a.call(this,c,"silverlight",{access_binary:a.capTrue,
access_image_binary:a.capTrue,display_media:a.capTest(!!L["moxie/image/Image"]),do_cors:a.capTrue,drag_and_drop:!1,report_upload_progress:a.capTrue,resize_image:a.capTrue,return_response_headers:function(a){return a&&"client"===h.mode},return_response_type:function(a){return"json"!==a?!0:!!window.JSON},return_status_code:function(a){return"client"===h.mode||!g.arrayDiff(a,[200,404])},select_file:a.capTrue,select_multiple:a.capTrue,send_binary_string:a.capTrue,send_browser_cookies:function(a){return a&&
"browser"===h.mode},send_custom_headers:function(a){return a&&"client"===h.mode},send_multipart:a.capTrue,slice_blob:a.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:a.capTrue,use_http_method:function(a){return"client"===h.mode||!g.arrayDiff(a,["GET","POST"])}},{return_response_headers:function(a){return a?"client":"browser"},return_status_code:function(a){return g.arrayDiff(a,[200,404])?"client":["client","browser"]},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?
"client":"browser"},use_http_method:function(a){return g.arrayDiff(a,["GET","POST"])?"client":["client","browser"]}});b("2.0.31005.0")&&"Opera"!==k.browser||(MXI_DEBUG&&k.debug.runtime&&k.log("\tSilverlight is not installed or minimal version (2.0.31005.0) requirement not met (not likely)."),this.mode=!1);g.extend(this,{getShim:function(){return d.get(this.uid).content.Moxie},shimExec:function(a,b){var c=[].slice.call(arguments,2);return h.getShim().exec(this.uid,a,b,c)},init:function(){this.getShimContainer().innerHTML=
'<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+c.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+a.getGlobalEventTarget()+'"/></object>';l=setTimeout(function(){h&&!h.initialized&&(h.trigger("Error",new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)),
MXI_DEBUG&&k.debug.runtime&&k.log("Silverlight failed to initialize within a specified period of time (5-10s)."))},"Windows"!==k.OS?1E4:5E3)},destroy:function(a){return function(){a.call(h);clearTimeout(l);c=l=a=h=null}}(this.destroy)},f)});return f});q("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(g,k,d){return g.Blob=k.extend({},d)});q("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime",
"moxie/file/File","moxie/core/utils/Dom","moxie/core/utils/Basic"],function(g,k,d,e){function a(a){for(var b="",c=0;c<a.length;c++)b+=(""!==b?"|":"")+a[c].title+" | *."+a[c].extensions.replace(/,/g,";*.");return b}return g.FileInput={init:function(b){var f=this,c=this.getRuntime(),g=d.get(b.browse_button);g&&(g.setAttribute("tabindex",-1),g=null);this.bind("Change",function(){var a=c.shimExec.call(f,"FileInput","getFiles");f.files=[];e.each(a,function(a){f.files.push(new k(c.uid,a))})},999);c.shimExec.call(this,
"FileInput","init",a(b.accept),b.multiple);this.trigger("ready")},setOption:function(b,d){"accept"==b&&(d=a(d));this.getRuntime().shimExec.call(this,"FileInput","setOption",b,d)}}});q("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(g,k,d){return g.FileDrop={init:function(){var e=this.getRuntime();var a=e.getShimContainer();d.addEvent(a,"dragover",function(a){a.preventDefault();a.stopPropagation();a.dataTransfer.dropEffect=
"copy"},this.uid);d.addEvent(a,"dragenter",function(a){a.preventDefault();k.get(e.uid).dragEnter(a)&&a.stopPropagation()},this.uid);d.addEvent(a,"drop",function(a){a.preventDefault();k.get(e.uid).dragDrop(a)&&a.stopPropagation()},this.uid);return e.shimExec.call(this,"FileDrop","init")}}});q("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(g,k,d){return g.FileReader=k.extend({},d)});q("moxie/runtime/silverlight/file/FileReaderSync",
["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(g,k,d){return g.FileReaderSync=k.extend({},d)});q("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(g,k,d){return g.Transporter=k.extend({},d)});q("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest",
"moxie/runtime/silverlight/file/FileReaderSync","moxie/runtime/silverlight/runtime/Transporter"],function(g,k,d,e,a){return g.XMLHttpRequest=k.extend({},d)});q("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/runtime/flash/image/Image"],function(g,k,d,e){return g.Image=k.extend({},e,{getInfo:function(){var a=this.getRuntime(),b=["tiff","exif","gps","thumb"],f={meta:{}},c=a.shimExec.call(this,"Image","getInfo");c.meta&&(k.each(b,
function(a){var b=c.meta[a],d,e;if(b&&b.keys){f.meta[a]={};var g=0;for(d=b.keys.length;g<d;g++){var h=b.keys[g];if(e=b[h])/^(\d|[1-9]\d+)$/.test(e)?e=parseInt(e,10):/^\d*\.\d+$/.test(e)&&(e=parseFloat(e)),f.meta[a][h]=e}}}),f.meta&&f.meta.thumb&&f.meta.thumb.data&&!(a.meta.thumb.data instanceof d)&&(f.meta.thumb.data=new d(a.uid,f.meta.thumb.data)));f.width=parseInt(c.width,10);f.height=parseInt(c.height,10);f.size=parseInt(c.size,10);f.type=c.type;f.name=c.name;return f},resize:function(a,b,d){this.getRuntime().shimExec.call(this,
"Image","resize",a.x,a.y,a.width,a.height,b,d.preserveHeaders,d.resample)}})});q("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(g,k,d,e){var a={};d.addConstructor("html4",function(b){var f=this,c=d.capTest,h=d.capTrue;d.call(this,b,"html4",{access_binary:c(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:c((e.can("create_canvas")||e.can("use_data_uri_over32kb"))&&!!L["moxie/image/Image"]),
do_cors:!1,drag_and_drop:!1,filter_by_extension:c(!("Chrome"===e.browser&&e.verComp(e.version,28,"<")||"IE"===e.browser&&e.verComp(e.version,10,"<")||"Safari"===e.browser&&e.verComp(e.version,7,"<")||"Firefox"===e.browser&&e.verComp(e.version,37,"<"))),resize_image:function(){return a.Image&&f.can("access_binary")&&e.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(a){return"json"===a&&window.JSON?!0:!!~g.inArray(a,["text","document",""])},return_status_code:function(a){return!g.arrayDiff(a,
[200,404])},select_file:function(){return e.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return f.can("select_file")},summon_file_dialog:function(){return f.can("select_file")&&!("Firefox"===e.browser&&e.verComp(e.version,4,"<")||"Opera"===e.browser&&e.verComp(e.version,12,"<")||"IE"===e.browser&&e.verComp(e.version,10,"<"))},upload_filesize:h,use_http_method:function(a){return!g.arrayDiff(a,["GET","POST"])}});
g.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(f);a=f=null}}(this.destroy)});g.extend(this.getShim(),a)});return a});q("moxie/runtime/html4/file/FileInput","moxie/runtime/html4/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(g,k,d,e,a,b,f){return g.FileInput=function(){function c(){var b=this,h=b.getRuntime(),n;var q=d.guid("uid_");var B=h.getShimContainer();
g&&(n=e.get(g+"_form"))&&(d.extend(n.style,{top:"100%"}),n.firstChild.setAttribute("tabindex",-1));var w=document.createElement("form");w.setAttribute("id",q+"_form");w.setAttribute("method","post");w.setAttribute("enctype","multipart/form-data");w.setAttribute("encoding","multipart/form-data");d.extend(w.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});var t=document.createElement("input");t.setAttribute("id",q);t.setAttribute("type","file");t.setAttribute("accept",
l.join(","));h.can("summon_file_dialog")&&t.setAttribute("tabindex",-1);d.extend(t.style,{fontSize:"999px",opacity:0});w.appendChild(t);B.appendChild(w);d.extend(t.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});"IE"===f.browser&&f.verComp(f.version,10,"<")&&d.extend(t.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});t.onchange=function(){if(this.value){var a=this.files?this.files[0]:{name:this.value};a=new k(h.uid,a);this.onchange=function(){};c.call(b);b.files=
[a];t.setAttribute("id",a.uid);w.setAttribute("id",a.uid+"_form");b.trigger("change");t=w=null}};h.can("summon_file_dialog")&&(B=e.get(m.browse_button),a.removeEvent(B,"click",b.uid),a.addEvent(B,"click",function(a){t&&!t.disabled&&t.click();a.preventDefault()},b.uid));g=q;B=n=B=null}var g,l=[],m,n;d.extend(this,{init:function(d){var f=this,g=f.getRuntime();m=d;l=b.extList2mimes(d.accept,g.can("filter_by_extension"));var h=g.getShimContainer();(function(){var b;var c=e.get(d.browse_button);n=e.getStyle(c,
"z-index")||"auto";g.can("summon_file_dialog")?("static"===e.getStyle(c,"position")&&(c.style.position="relative"),f.bind("Refresh",function(){b=parseInt(n,10)||1;e.get(m.browse_button).style.zIndex=b;this.getRuntime().getShimContainer().style.zIndex=b-1})):c.setAttribute("tabindex",-1);c=g.can("summon_file_dialog")?c:h;a.addEvent(c,"mouseover",function(){f.trigger("mouseenter")},f.uid);a.addEvent(c,"mouseout",function(){f.trigger("mouseleave")},f.uid);a.addEvent(c,"mousedown",function(){f.trigger("mousedown")},
f.uid);a.addEvent(e.get(d.container),"mouseup",function(){f.trigger("mouseup")},f.uid);c=null})();c.call(this);h=null;f.trigger({type:"ready",async:!0})},setOption:function(a,c){var d=this.getRuntime();"accept"==a&&(l=c.mimes||b.extList2mimes(c,d.can("filter_by_extension")));(d=e.get(g))&&d.setAttribute("accept",l.join(","))},disable:function(a){var b;if(b=e.get(g))b.disabled=!!a},destroy:function(){var b=this.getRuntime(),c=b.getShim();b=b.getShimContainer();var d=m&&e.get(m.container),f=m&&e.get(m.browse_button);
d&&a.removeAllEvents(d,this.uid);f&&(a.removeAllEvents(f,this.uid),f.style.zIndex=n);b&&(a.removeAllEvents(b,this.uid),b.innerHTML="");c.removeInstance(this.uid);g=l=m=null}})}});q("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(g,k){return g.FileReader=k});q("moxie/runtime/html4/xhr/XMLHttpRequest","moxie/runtime/html4/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Url moxie/core/Exceptions moxie/core/utils/Events moxie/file/Blob moxie/xhr/FormData".split(" "),
function(g,k,d,e,a,b,f,c){return g.XMLHttpRequest=function(){function g(a){var c=this,f,e=!1;if(n){var g=n.id.replace(/_iframe$/,"");if(g=d.get(g+"_form")){var h=g.getElementsByTagName("input");for(f=h.length;f--;)switch(h[f].getAttribute("type")){case "hidden":h[f].parentNode.removeChild(h[f]);break;case "file":e=!0}h=[];e||g.parentNode.removeChild(g);g=null}setTimeout(function(){b.removeEvent(n,"load",c.uid);n.parentNode&&n.parentNode.removeChild(n);var d=c.getRuntime().getShimContainer();d.children.length||
d.parentNode.removeChild(d);n=null;a()},1)}}var l,m,n;k.extend(this,{send:function(h,q){var p=this,v=p.getRuntime();l=m=null;if(q instanceof c&&q.hasBlob()){var r=q.getBlob();var w=r.uid;var t=d.get(w);var u=d.get(w+"_form");if(!u)throw new a.DOMException(a.DOMException.NOT_FOUND_ERR);}else w=k.guid("uid_"),u=document.createElement("form"),u.setAttribute("id",w+"_form"),u.setAttribute("method",h.method),u.setAttribute("enctype","multipart/form-data"),u.setAttribute("encoding","multipart/form-data"),
v.getShimContainer().appendChild(u);u.setAttribute("target",w+"_iframe");q instanceof c&&q.each(function(a,b){if(a instanceof f)t&&t.setAttribute("name",b);else{var c=document.createElement("input");k.extend(c,{type:"hidden",name:b,value:a});t?u.insertBefore(c,t):u.appendChild(c)}});u.setAttribute("action",h.url);(function(){var a=v.getShimContainer()||document.body,c=document.createElement("div");c.innerHTML='<iframe id="'+w+'_iframe" name="'+w+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';
n=c.firstChild;a.appendChild(n);b.addEvent(n,"load",function(){try{var a=n.contentWindow.document||n.contentDocument||window.frames[n.id].document;/^4(0[0-9]|1[0-7]|2[2346])\s/.test(a.title)?l=a.title.replace(/^(\d+).*$/,"$1"):(l=200,m=k.trim(a.body.innerHTML),p.trigger({type:"progress",loaded:m.length,total:m.length}),r&&p.trigger({type:"uploadprogress",loaded:r.size||1025,total:r.size||1025}))}catch(z){if(e.hasSameOrigin(h.url))l=404;else{g.call(p,function(){p.trigger("error")});return}}g.call(p,
function(){p.trigger("load")})},p.uid)})();u.submit();p.trigger("loadstart")},getStatus:function(){return l},getResponse:function(a){if("json"===a&&"string"===k.typeOf(m)&&window.JSON)try{return JSON.parse(m.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(p){return null}return m},abort:function(){var a=this;n&&n.contentWindow&&(n.contentWindow.stop?n.contentWindow.stop():n.contentWindow.document.execCommand?n.contentWindow.document.execCommand("Stop"):n.src="about:blank");g.call(this,
function(){a.dispatchEvent("abort")})},destroy:function(){this.getRuntime().getShim().removeInstance(this.uid)}})}});q("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(g,k){return g.Image=k});(function(g){for(var k=0;k<g.length;k++){for(var d=J,e=g[k],a=e.split(/[.\/]/),b=0;b<a.length-1;++b)d[a[b]]===I&&(d[a[b]]={}),d=d[a[b]];d[a[a.length-1]]=L[e]}})("moxie/core/utils/Basic moxie/core/utils/Encode moxie/core/utils/Env moxie/core/Exceptions moxie/core/utils/Dom moxie/core/EventTarget moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/file/Blob moxie/core/I18n moxie/core/utils/Mime moxie/file/FileInput moxie/file/File moxie/file/FileDrop moxie/file/FileReader moxie/core/utils/Url moxie/runtime/RuntimeTarget moxie/xhr/FormData moxie/xhr/XMLHttpRequest moxie/image/Image moxie/core/utils/Events moxie/runtime/html5/image/ResizerCanvas".split(" "))})(this)});
(function(J,I){var r=function(){var q={};I.apply(q,arguments);return q.plupload};"function"===typeof define&&define.amd?define("plupload",["./moxie"],r):"object"===typeof module&&module.exports?module.exports=r(require("./moxie")):J.plupload=r(J.moxie)})(this||window,function(J){(function(I,r,q){function L(b){function d(a,b,c){var d={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",
drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};d[a]?e[d[a]]=b:c||(e[a]=b)}var c=b.required_features,e={};"string"===typeof c?a.each(c.split(/\s*,\s*/),function(a){d(a,!0)}):"object"===typeof c?a.each(c,function(a,b){d(b,a)}):!0===c&&(b.chunk_size&&0<b.chunk_size&&(e.slice_blob=!0),a.isEmptyObj(b.resize)&&!1!==b.multipart||(e.send_binary_string=!0),b.http_method&&(e.use_http_method=b.http_method),
a.each(b,function(a,b){d(b,!!a,!0)}));return e}var g=window.setTimeout,k={},d=r.core.utils,e=r.runtime.Runtime,a={VERSION:"2.3.6",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,moxie:r,mimeTypes:d.Mime.mimes,ua:d.Env,typeOf:d.Basic.typeOf,extend:d.Basic.extend,guid:d.Basic.guid,
getAll:function(b){var d=[],c;"array"!==a.typeOf(b)&&(b=[b]);for(var e=b.length;e--;)(c=a.get(b[e]))&&d.push(c);return d.length?d:null},get:d.Dom.get,each:d.Basic.each,getPos:d.Dom.getPos,getSize:d.Dom.getSize,xmlEncode:function(a){var b={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},c=/[<>&"']/g;return a?(""+a).replace(c,function(a){return b[a]?"&"+b[a]+";":a}):a},toArray:d.Basic.toArray,inArray:d.Basic.inArray,inSeries:d.Basic.inSeries,addI18n:r.core.I18n.addI18n,translate:r.core.I18n.translate,
sprintf:d.Basic.sprintf,isEmptyObj:d.Basic.isEmptyObj,hasClass:d.Dom.hasClass,addClass:d.Dom.addClass,removeClass:d.Dom.removeClass,getStyle:d.Dom.getStyle,addEvent:d.Events.addEvent,removeEvent:d.Events.removeEvent,removeAllEvents:d.Events.removeAllEvents,cleanName:function(a){var b;var c=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,
"U",/[\371-\374]/g,"u"];for(b=0;b<c.length;b+=2)a=a.replace(c[b],c[b+1]);a=a.replace(/\s+/g,"_");return a=a.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(b,d){var c="";a.each(d,function(a,b){c+=(c?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a)});c&&(b+=(0<b.indexOf("?")?"&":"?")+c);return b},formatSize:function(b){function d(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}if(b===q||/\D/.test(b))return a.translate("N/A");var c=Math.pow(1024,4);return b>c?d(b/c,1)+" "+a.translate("tb"):
b>(c/=1024)?d(b/c,1)+" "+a.translate("gb"):b>(c/=1024)?d(b/c,1)+" "+a.translate("mb"):1024<b?Math.round(b/1024)+" "+a.translate("kb"):b+" "+a.translate("b")},parseSize:d.Basic.parseSizeStr,predictRuntime:function(b,d){var c=new a.Uploader(b);var f=e.thatCan(c.getOption().required_features,d||b.runtimes);c.destroy();return f},addFileFilter:function(a,d){k[a]=d}};a.addFileFilter("mime_types",function(b,d,c){b.length&&!b.regexp.test(d.name)?(this.trigger("Error",{code:a.FILE_EXTENSION_ERROR,message:a.translate("File extension error."),
file:d}),c(!1)):c(!0)});a.addFileFilter("max_file_size",function(b,d,c){b=a.parseSize(b);void 0!==d.size&&b&&d.size>b?(this.trigger("Error",{code:a.FILE_SIZE_ERROR,message:a.translate("File size error."),file:d}),c(!1)):c(!0)});a.addFileFilter("prevent_duplicates",function(b,d,c){if(b)for(b=this.files.length;b--;)if(d.name===this.files[b].name&&d.size===this.files[b].size){this.trigger("Error",{code:a.FILE_DUPLICATE_ERROR,message:a.translate("Duplicate file error."),file:d});c(!1);return}c(!0)});
a.addFileFilter("prevent_empty",function(b,d,c){b&&!d.size&&d.size!==q?(this.trigger("Error",{code:a.FILE_SIZE_ERROR,message:a.translate("File size error."),file:d}),c(!1)):c(!0)});a.Uploader=function(b){function d(){var b=0,d;if(this.state==a.STARTED){for(d=0;d<z.length;d++)if(c||z[d].status!=a.QUEUED)b++;else{var c=z[d];this.trigger("BeforeUpload",c)&&(c.status=a.UPLOADING,this.trigger("UploadFile",c))}b==z.length&&(this.state!==a.STOPPED&&(this.state=a.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",
z))}}function c(a){a.percent=0<a.size?Math.ceil(a.loaded/a.size*100):100;h()}function h(){var b,d=0;E.reset();for(b=0;b<z.length;b++){var c=z[b];if(c.size!==q){E.size+=c.origSize;var e=c.loaded*c.origSize/c.size;if(!c.completeTimestamp||c.completeTimestamp>K)d+=e;E.loaded+=e}else E.size=q;c.status==a.DONE?E.uploaded++:c.status==a.FAILED?E.failed++:E.queued++}E.size===q?E.percent=0<z.length?Math.ceil(E.uploaded/z.length*100):0:(E.bytesPerSec=Math.ceil(d/((+new Date-K||1)/1E3)),E.percent=0<E.size?Math.ceil(E.loaded/
E.size*100):0)}function l(){var a=G[0]||M[0];return a?a.getRuntime().uid:!1}function m(){this.bind("FilesAdded FilesRemoved",function(a){a.trigger("QueueChanged");a.refresh()});this.bind("CancelUpload",t);this.bind("BeforeUpload",A);this.bind("UploadFile",I);this.bind("UploadProgress",B);this.bind("StateChanged",w);this.bind("QueueChanged",h);this.bind("Error",C);this.bind("FileUploaded",u);this.bind("Destroy",J)}function n(b,d){var c=this,f=0,g=[],h={runtime_order:b.runtimes,required_caps:b.required_features,
preferred_caps:O,swf_url:b.flash_swf_url,xap_url:b.silverlight_xap_url};a.each(b.runtimes.split(/\s*,\s*/),function(a){b[a]&&(h[a]=b[a])});b.browse_button&&a.each(b.browse_button,function(d){g.push(function(g){var k=new r.file.FileInput(a.extend({},h,{accept:b.filters.mime_types,name:b.file_data_name,multiple:b.multi_selection,container:b.container,browse_button:d}));k.onready=function(){var b=e.getInfo(this.ruid);a.extend(c.features,{chunks:b.can("slice_blob"),multipart:b.can("send_multipart"),multi_selection:b.can("select_multiple")});
f++;G.push(this);g()};k.onchange=function(){c.addFile(this.files)};k.bind("mouseenter mouseleave mousedown mouseup",function(c){N||(b.browse_button_hover&&("mouseenter"===c.type?a.addClass(d,b.browse_button_hover):"mouseleave"===c.type&&a.removeClass(d,b.browse_button_hover)),b.browse_button_active&&("mousedown"===c.type?a.addClass(d,b.browse_button_active):"mouseup"===c.type&&a.removeClass(d,b.browse_button_active)))});k.bind("mousedown",function(){c.trigger("Browse")});k.bind("error runtimeerror",
function(){k=null;g()});k.init()})});b.drop_element&&a.each(b.drop_element,function(b){g.push(function(d){var g=new r.file.FileDrop(a.extend({},h,{drop_zone:b}));g.onready=function(){var b=e.getInfo(this.ruid);a.extend(c.features,{chunks:b.can("slice_blob"),multipart:b.can("send_multipart"),dragdrop:b.can("drag_and_drop")});f++;M.push(this);d()};g.ondrop=function(){c.addFile(this.files)};g.bind("error runtimeerror",function(){g=null;d()});g.init()})});a.inSeries(g,function(){"function"===typeof d&&
d(f)})}function v(a,b,d,c){var e=new r.image.Image;try{e.onload=function(){b.width>this.width&&b.height>this.height&&b.quality===q&&b.preserve_headers&&!b.crop?(this.destroy(),c(a)):e.downsize(b.width,b.height,b.crop,b.preserve_headers)},e.onresize=function(){var d=this.getAsBlob(a.type,b.quality);this.destroy();c(d)},e.bind("error runtimeerror",function(){this.destroy();c(a)}),e.load(a,d)}catch(S){c(a)}}function p(b,d,c){function f(b,c,d){var e=x[b];switch(b){case "max_file_size":"max_file_size"===
b&&(x.max_file_size=x.filters.max_file_size=c);break;case "chunk_size":if(c=a.parseSize(c))x[b]=c,x.send_file_name=!0;break;case "multipart":x[b]=c;c||(x.send_file_name=!0);break;case "http_method":x[b]="PUT"===c.toUpperCase()?"PUT":"POST";break;case "unique_names":if(x[b]=c)x.send_file_name=!0;break;case "filters":"array"===a.typeOf(c)&&(c={mime_types:c});d?a.extend(x.filters,c):x.filters=c;c.mime_types&&("string"===a.typeOf(c.mime_types)&&(c.mime_types=r.core.utils.Mime.mimes2extList(c.mime_types)),
c.mime_types.regexp=function(b){var c=[];a.each(b,function(b){a.each(b.extensions.split(/,/),function(a){/^\s*\*\s*$/.test(a)?c.push("\\.*"):c.push("\\."+a.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})});return new RegExp("("+c.join("|")+")$","i")}(c.mime_types),x.filters.mime_types=c.mime_types);break;case "resize":x.resize=c?a.extend({preserve_headers:!0,crop:!1},c):!1;break;case "prevent_duplicates":x.prevent_duplicates=x.filters.prevent_duplicates=!!c;break;
case "container":case "browse_button":case "drop_element":c="container"===b?a.get(c):a.getAll(c);case "runtimes":case "multi_selection":case "flash_swf_url":case "silverlight_xap_url":x[b]=c;d||(h=!0);break;default:x[b]=c}d||g.trigger("OptionChanged",b,c,e)}var g=this,h=!1;"object"===typeof b?a.each(b,function(a,b){f(b,a,c)}):f(b,d,c);c?(x.required_features=L(a.extend({},x)),O=L(a.extend({},x,{required_features:!0}))):h&&(g.trigger("Destroy"),n.call(g,x,function(b){b?(g.runtime=e.getInfo(l()).type,
g.trigger("Init",{runtime:g.runtime}),g.trigger("PostInit")):g.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})}))}function A(a,b){if(a.settings.unique_names){var c=b.name.match(/\.([^.]+)$/),d="part";c&&(d=c[1]);b.target_name=b.id+"."+d}}function I(b,c){function d(){0<l--?g(e,1E3):(c.loaded=n,b.trigger("Error",{code:a.HTTP_ERROR,message:a.translate("HTTP Error."),file:c,response:y.responseText,status:y.status,responseHeaders:y.getAllResponseHeaders()}))}function e(){var d=
{};if(c.status===a.UPLOADING&&b.state!==a.STOPPED){b.settings.send_file_name&&(d.name=c.target_name||c.name);if(k&&m.chunks&&p.size>k){var e=Math.min(k,p.size-n);var g=p.slice(n,n+e)}else e=p.size,g=p;k&&m.chunks&&(b.settings.send_chunk_number?(d.chunk=Math.ceil(n/k),d.chunks=Math.ceil(p.size/k)):(d.offset=n,d.total=p.size));b.trigger("BeforeChunkUpload",c,d,g,n)&&f(d,g,e)}}function f(f,k,R){y=new r.xhr.XMLHttpRequest;y.upload&&(y.upload.onprogress=function(a){c.loaded=Math.min(c.size,n+a.loaded);
b.trigger("UploadProgress",c)});y.onload=function(){200>y.status||400<=y.status?d():(l=b.settings.max_retries,R<p.size?(k.destroy(),n+=R,c.loaded=Math.min(n,p.size),b.trigger("ChunkUploaded",c,{offset:c.loaded,total:p.size,response:y.responseText,status:y.status,responseHeaders:y.getAllResponseHeaders()}),"Android Browser"===a.ua.browser&&b.trigger("UploadProgress",c)):c.loaded=c.size,k=P=null,!n||n>=p.size?(c.size!=c.origSize&&(p.destroy(),p=null),b.trigger("UploadProgress",c),c.status=a.DONE,c.completeTimestamp=
+new Date,b.trigger("FileUploaded",c,{response:y.responseText,status:y.status,responseHeaders:y.getAllResponseHeaders()})):g(e,1))};y.onerror=function(){d()};y.onloadend=function(){this.destroy()};if(b.settings.multipart&&m.multipart){y.open(b.settings.http_method,h,!0);a.each(b.settings.headers,function(a,b){y.setRequestHeader(b,a)});var P=new r.xhr.FormData;a.each(a.extend(f,b.settings.multipart_params),function(a,b){P.append(b,a)});P.append(b.settings.file_data_name,k);y.send(P,q)}else h=a.buildUrl(b.settings.url,
a.extend(f,b.settings.multipart_params)),y.open(b.settings.http_method,h,!0),a.each(b.settings.headers,function(a,b){y.setRequestHeader(b,a)}),y.hasRequestHeader("Content-Type")||y.setRequestHeader("Content-Type","application/octet-stream"),y.send(k,q)}var h=b.settings.url,k=b.settings.chunk_size,l=b.settings.max_retries,m=b.features,n=0,q={runtime_order:b.settings.runtimes,required_caps:b.settings.required_features,preferred_caps:O,swf_url:b.settings.flash_swf_url,xap_url:b.settings.silverlight_xap_url};
c.loaded&&(n=c.loaded=k?k*Math.floor(c.loaded/k):0);var p=c.getSource();a.isEmptyObj(b.settings.resize)||-1===a.inArray(p.type,["image/jpeg","image/png"])?e():v(p,b.settings.resize,q,function(a){p=a;c.size=a.size;e()})}function B(a,b){c(b)}function w(b){if(b.state==a.STARTED)K=+new Date;else if(b.state==a.STOPPED)for(var c=b.files.length-1;0<=c;c--)b.files[c].status==a.UPLOADING&&(b.files[c].status=a.QUEUED,h())}function t(){y&&y.abort()}function u(a){h();g(function(){d.call(a)},1)}function C(b,e){e.code===
a.INIT_ERROR?b.destroy():e.code===a.HTTP_ERROR&&(e.file.status=a.FAILED,e.file.completeTimestamp=+new Date,c(e.file),b.state==a.STARTED&&(b.trigger("CancelUpload"),g(function(){d.call(b)},1)))}function J(b){b.stop();a.each(z,function(a){a.destroy()});z=[];G.length&&(a.each(G,function(a){a.destroy()}),G=[]);M.length&&(a.each(M,function(a){a.destroy()}),M=[]);O={};N=!1;K=y=null;E.reset()}var H=a.guid(),z=[],O={},G=[],M=[],K,N=!1,y;var x={chunk_size:0,file_data_name:"file",filters:{mime_types:[],max_file_size:0,
prevent_duplicates:!1,prevent_empty:!0},flash_swf_url:"js/Moxie.swf",http_method:"POST",max_retries:0,multipart:!0,multi_selection:!0,resize:!1,runtimes:e.order,send_file_name:!0,send_chunk_number:!0,silverlight_xap_url:"js/Moxie.xap"};p.call(this,b,null,!0);var E=new a.QueueProgress;a.extend(this,{id:H,uid:H,state:a.STOPPED,features:{},runtime:null,files:z,settings:x,total:E,init:function(){var b=this,c;var d=b.getOption("preinit");"function"==typeof d?d(b):a.each(d,function(a,c){b.bind(c,a)});m.call(b);
a.each(["container","browse_button","drop_element"],function(d){if(null===b.getOption(d))return c={code:a.INIT_ERROR,message:a.sprintf(a.translate("%s specified, but cannot be found."),d)},!1});if(c)return b.trigger("Error",c);if(!x.browse_button&&!x.drop_element)return b.trigger("Error",{code:a.INIT_ERROR,message:a.translate("You must specify either browse_button or drop_element.")});n.call(b,x,function(c){var d=b.getOption("init");"function"==typeof d?d(b):a.each(d,function(a,c){b.bind(c,a)});c?
(b.runtime=e.getInfo(l()).type,b.trigger("Init",{runtime:b.runtime}),b.trigger("PostInit")):b.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})})},setOption:function(a,b){p.call(this,a,b,!this.runtime)},getOption:function(a){return a?x[a]:x},refresh:function(){G.length&&a.each(G,function(a){a.trigger("Refresh")});this.trigger("Refresh")},start:function(){this.state!=a.STARTED&&(this.state=a.STARTED,this.trigger("StateChanged"),d.call(this))},stop:function(){this.state!=a.STOPPED&&
(this.state=a.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(b){N=b!==q?b:!0;G.length&&a.each(G,function(a){a.disable(N)});this.trigger("DisableBrowse",N)},getFile:function(a){var b;for(b=z.length-1;0<=b;b--)if(z[b].id===a)return z[b]},addFile:function(b,c){function d(b,c){var d=[];a.each(f.settings.filters,function(a,c){k[c]&&d.push(function(d){k[c].call(f,a,b,function(a){d(!a)})})});a.inSeries(d,c)}function e(b){var k=a.typeOf(b);if(b instanceof r.file.File){if(!b.ruid&&
!b.isDetached()){if(!n)return!1;b.ruid=n;b.connectRuntime(n)}e(new a.File(b))}else b instanceof r.file.Blob?(e(b.getSource()),b.destroy()):b instanceof a.File?(c&&(b.name=c),h.push(function(a){d(b,function(c){c||(z.push(b),m.push(b),f.trigger("FileFiltered",b));g(a,1)})})):-1!==a.inArray(k,["file","blob"])?e(new r.file.File(null,b)):"node"===k&&"filelist"===a.typeOf(b.files)?a.each(b.files,e):"array"===k&&(c=null,a.each(b,e))}var f=this,h=[],m=[];var n=l();e(b);h.length&&a.inSeries(h,function(){m.length&&
f.trigger("FilesAdded",m)})},removeFile:function(a){a="string"===typeof a?a:a.id;for(var b=z.length-1;0<=b;b--)if(z[b].id===a)return this.splice(b,1)[0]},splice:function(b,c){var d=z.splice(b===q?0:b,c===q?z.length:c),e=!1;this.state==a.STARTED&&(a.each(d,function(b){if(b.status===a.UPLOADING)return e=!0,!1}),e&&this.stop());this.trigger("FilesRemoved",d);a.each(d,function(a){a.destroy()});e&&this.start();return d},dispatchEvent:function(a){var b;a=a.toLowerCase();if(b=this.hasEventListener(a)){b.sort(function(a,
b){return b.priority-a.priority});var c=[].slice.call(arguments);c.shift();c.unshift(this);for(var d=0;d<b.length;d++)if(!1===b[d].fn.apply(b[d].scope,c))return!1}return!0},bind:function(b,c,d,e){a.Uploader.prototype.bind.call(this,b,c,e,d)},destroy:function(){this.trigger("Destroy");x=E=null;this.unbindAll()}})};a.Uploader.prototype=r.core.EventTarget.instance;a.File=function(){var b={};return function(d){a.extend(this,{id:a.guid(),name:d.name||d.fileName,type:d.type||"",relativePath:d.relativePath||
"",size:d.fileSize||d.size,origSize:d.fileSize||d.size,loaded:0,percent:0,status:a.QUEUED,lastModifiedDate:d.lastModifiedDate||(new Date).toLocaleString(),completeTimestamp:0,getNative:function(){var b=this.getSource().getSource();return-1!==a.inArray(a.typeOf(b),["blob","file"])?b:null},getSource:function(){return b[this.id]?b[this.id]:null},destroy:function(){var a=this.getSource();a&&(a.destroy(),delete b[this.id])}});b[this.id]=d}}();a.QueueProgress=function(){var a=this;a.size=0;a.loaded=0;a.uploaded=
0;a.failed=0;a.queued=0;a.percent=0;a.bytesPerSec=0;a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}};I.plupload=a})(this,J)});